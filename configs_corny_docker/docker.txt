Server:
 Version:      1.12.1
 API version:  1.24
 Go version:   go1.6.3
 Git commit:   23cf638
 Built:        Thu Aug 18 05:33:38 2016
 OS/Arch:      linux/amd64



New docker network to isolate our app. 
create a new network which disallows inter-container-communication. We will call this network "mynet"
# docker network create -d bridge --subnet=10.0.0.0/8 --gateway=10.42.0.100 --opt="com.docker.network.bridge.enable_icc=false" mynet

--
corny@corny-VirtualBox:~$ sudo docker network create -d bridge --subnet=10.0.0.0/8 --gateway=10.42.0.100 --opt="com.docker.network.bridge.enable_icc=false" mynet
b74b417b331fd5bccf2884750f090630740d3581475a61eba29b04f59334f270
corny@corny-VirtualBox:~$ sudo docker network inspect mynet
[
    {
        "Name": "mynet",
        "Id": "b74b417b331fd5bccf2884750f090630740d3581475a61eba29b04f59334f270",
        "Scope": "local",
        "Driver": "bridge",
        "EnableIPv6": false,
        "IPAM": {
            "Driver": "default",
            "Options": {},
            "Config": [
                {
                    "Subnet": "10.0.0.0/8",
                    "Gateway": "10.42.0.100"
                }
            ]
        },
        "Internal": false,
        "Containers": {},
        "Options": {
            "com.docker.network.bridge.enable_icc": "false"
        },
        "Labels": {}
    }
]
--

Start webfrnt (using busybox image)

sudo docker run --rm -ti --name webfrnt --hostname webfrnt --net mynet --ip 10.0.0.1 busybox
/ # ifconfig 
eth0      Link encap:Ethernet  HWaddr 02:42:0A:00:00:01  
          inet addr:10.0.0.1  Bcast:0.0.0.0  Mask:255.0.0.0
          inet6 addr: fe80::42:aff:fe00:1/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:12 errors:0 dropped:0 overruns:0 frame:0
          TX packets:6 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:1016 (1016.0 B)  TX bytes:508 (508.0 B)

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1 
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

/ # hostname 
webfrnt
/ # route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         10.42.0.100     0.0.0.0         UG    0      0        0 eth0
10.0.0.0        0.0.0.0         255.0.0.0       U     0      0        0 eth0
/ #


sudo docker run --rm -ti --name log --hostname log --net mynet --ip 10.0.0.2 busybox
sudo docker run --rm -ti --name db --hostname db --net mynet --ip 10.0.0.3 busybox
sudo docker run --rm -ti --name webapp --hostname webapp --net mynet --ip 10.0.0.4 busybox

All the containers cannot reach each other but they can connect to the Internet.

For the sake of example, since this is specific to docker and not our solution in general, we do not make the containers world-reachable. 
docker-specific which pots are exported, ...



Implementing policy

docker has created the following rules:
# Generated by iptables-save v1.6.0 on Thu Sep 15 13:42:24 2016
*nat
:PREROUTING ACCEPT [6:444]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [63:3924]
:POSTROUTING ACCEPT [22:1376]
:DOCKER - [0:0]
-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER
-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER
-A POSTROUTING -s 10.0.0.0/8 ! -o br-b74b417b331f -j MASQUERADE
-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE
-A DOCKER -i br-b74b417b331f -j RETURN
-A DOCKER -i docker0 -j RETURN
COMMIT
# Completed on Thu Sep 15 13:42:24 2016
# Generated by iptables-save v1.6.0 on Thu Sep 15 13:42:24 2016
*filter
:INPUT ACCEPT [184:31271]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [179:18898]
:DOCKER - [0:0]
:DOCKER-ISOLATION - [0:0]
-A FORWARD -j DOCKER-ISOLATION
-A FORWARD -o br-b74b417b331f -j DOCKER
-A FORWARD -o br-b74b417b331f -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i br-b74b417b331f ! -o br-b74b417b331f -j ACCEPT
-A FORWARD -o docker0 -j DOCKER
-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i docker0 ! -o docker0 -j ACCEPT
-A FORWARD -i docker0 -o docker0 -j ACCEPT
-A FORWARD -i br-b74b417b331f -o br-b74b417b331f -j DROP
-A DOCKER-ISOLATION -i docker0 -o br-b74b417b331f -j DROP
-A DOCKER-ISOLATION -i br-b74b417b331f -o docker0 -j DROP
-A DOCKER-ISOLATION -j RETURN
COMMIT
# Completed on Thu Sep 15 13:42:24 2016

The interface br-b74b417b331f is the bridge for "mynet"

For simplicity, we approximate the internate-facing interface by "! -i br-b74b417b331f"
On my docker, it is "enp0s3"





tuning:
# Generated by iptables-save v1.6.0 on Thu Sep 15 13:42:24 2016
*nat
:PREROUTING ACCEPT [6:444]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [63:3924]
:POSTROUTING ACCEPT [22:1376]
:DOCKER - [0:0]
-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER
-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER
-A POSTROUTING -s 10.0.0.0/8 ! -o br-b74b417b331f -j MASQUERADE
-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE
-A DOCKER -i br-b74b417b331f -j RETURN
-A DOCKER -i docker0 -j RETURN
COMMIT
# Completed on Thu Sep 15 13:42:24 2016
# Generated by iptables-save v1.6.0 on Thu Sep 15 13:42:24 2016
*filter
:INPUT ACCEPT [184:31271]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [179:18898]
:DOCKER - [0:0]
:DOCKER-ISOLATION - [0:0]
:MYNET - [0:0]
-A FORWARD -j DOCKER-ISOLATION
-A FORWARD -j MYNET
-A FORWARD -o br-b74b417b331f -j DOCKER
-A FORWARD -o br-b74b417b331f -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i br-b74b417b331f ! -o br-b74b417b331f -j ACCEPT
-A FORWARD -o docker0 -j DOCKER
-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i docker0 ! -o docker0 -j ACCEPT
-A FORWARD -i docker0 -o docker0 -j ACCEPT
-A FORWARD -i br-b74b417b331f -o br-b74b417b331f -j DROP
-A DOCKER-ISOLATION -i docker0 -o br-b74b417b331f -j DROP
-A DOCKER-ISOLATION -i br-b74b417b331f -o docker0 -j DROP
-A DOCKER-ISOLATION -j RETURN
-A MYNET -m state --state ESTABLISHED ! -i br-b74b417b331f -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT
-A MYNET -m state --state ESTABLISHED -i br-b74b417b331f -s 10.0.0.1 ! -o br-b74b417b331f -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.1 -o br-b74b417b331f -d 10.0.0.1 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.1 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.1 -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.3 -o br-b74b417b331f -d 10.0.0.3 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.3 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.3 -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.2 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.1 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.3 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.4 ! -o br-b74b417b331f -j ACCEPT
-A MYNET ! -i br-b74b417b331f -o br-b74b417b331f -d 10.0.0.1 -j ACCEPT
-A MYNET -i br-b74b417b331f -j DROP
COMMIT
# Completed on Thu Sep 15 13:42:24 2016


Tested connectivity:
webapp can connect (even to inet, webfrnt cannot connect to inet)
onedirectional connectivity to log

IT WORKS!!

service matrix:


fffuu:
ipassmt
docker0 = [172.17.0.1/16]
br-b74b417b331f = [10.0.0.0/8]

$ ./dist/build/fffuu/fffuu --ipassmt ipassmt_docker dockermynet
Parsed IpAssmt
IpAssmt [(docker0,Pos [172.17.0.1/16]),(br-b74b417b331f,Pos [10.0.0.0/8])]
== Checking which tables are supported for analysis. Usually, only `filter'. ==
sanity_wf_ruleset passed
Parsed 6 chains in table filter, a total of 29 rules
Table `nat' caught exception: `Reading ruleset failed! sanity_wf_ruleset check failed.'. Analysis not possible for this table. This is probably due to unsupportd actions (or a bug in the parser).
== Transformed to Isabelle type (only filter table) ==
== unfolded FORWARD chain (upper closure) ==
sanity_wf_ruleset passed
(-o br-b74b417b331f -i docker0, -j DROP)
(-o docker0 -i br-b74b417b331f, -j DROP)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.4/32 -m state --state ESTABLISHED, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -s 10.0.0.1/32 -m state --state ESTABLISHED, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.1/32 -s 10.0.0.1/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.1/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.4/32 -s 10.0.0.1/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.3/32 -s 10.0.0.3/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.3/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.4/32 -s 10.0.0.3/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.2/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.1/32 -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.3/32 -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.4/32 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32, -j ACCEPT)
(-i br-b74b417b331f, -j DROP)
(-o br-b74b417b331f -m state --state ESTABLISHED,RELATED, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f, -j ACCEPT)
(-o docker0 -m state --state ESTABLISHED,RELATED, -j ACCEPT)
(! -o docker0 -i docker0, -j ACCEPT)
(-o docker0 -i docker0, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f, -j DROP)
(, -j ACCEPT)
== to simple firewall ==
DROP     all  --  0.0.0.0/0            0.0.0.0/0 in: docker0 out: br-b74b417b331f  
DROP     all  --  0.0.0.0/0            0.0.0.0/0 in: br-b74b417b331f out: docker0  
ACCEPT     all  --  10.0.0.1/32            10.0.0.1/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.1/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.1/32            10.0.0.4/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.3/32            10.0.0.3/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.3/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.3/32            10.0.0.4/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.2/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.1/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.3/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.4/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            0.0.0.0/0 in: br-b74b417b331f   
ACCEPT     all  --  0.0.0.0/0            10.0.0.1/32  out: br-b74b417b331f  
DROP     all  --  0.0.0.0/0            0.0.0.0/0 in: br-b74b417b331f   
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0 in: br-b74b417b331f   
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0 in: docker0   
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0 in: docker0 out: docker0  
DROP     all  --  0.0.0.0/0            0.0.0.0/0 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0    
== to even-simpler firewall ==
ACCEPT     all  --  10.0.0.1/32            10.0.0.1/32    
ACCEPT     all  --  10.0.0.1/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.1/32            10.0.0.4/32    
ACCEPT     all  --  10.0.0.3/32            10.0.0.3/32    
ACCEPT     all  --  10.0.0.3/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.3/32            10.0.0.4/32    
ACCEPT     all  --  10.0.0.2/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.1/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.3/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.4/32    
ACCEPT     all  --  10.0.0.4/32            0.0.0.0/0    
ACCEPT     all  --  0.0.0.0/5            10.0.0.1/32    
ACCEPT     all  --  8.0.0.0/7            10.0.0.1/32    
ACCEPT     all  --  11.0.0.0/8            10.0.0.1/32    
ACCEPT     all  --  12.0.0.0/6            10.0.0.1/32    
ACCEPT     all  --  16.0.0.0/4            10.0.0.1/32    
ACCEPT     all  --  32.0.0.0/3            10.0.0.1/32    
ACCEPT     all  --  64.0.0.0/2            10.0.0.1/32    
ACCEPT     all  --  128.0.0.0/1            10.0.0.1/32    
DROP     all  --  10.0.0.0/8            0.0.0.0/0    
ACCEPT     all  --  10.0.0.0/8            0.0.0.0/0    
ACCEPT     all  --  172.17.0.0/16            0.0.0.0/0    
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0    
== checking spoofing protection ==
distinct: passed
ipassmt_sanity_nowildcards: passed
ipassmt_sanity_defined (interfaces defined in the ruleset are also in ipassmt): passed
ipassmt_sanity_disjoint (no zone-spanning interfaces): passed
ipassmt_sanity_disjoint excluding UNIV interfaces: passed
ipassmt_sanity_complete: the following is not covered: {0.0.0.0 .. 9.255.255.255} u {11.0.0.0 .. 172.16.255.255} u {172.18.0.0 .. 255.255.255.255}
ipassmt_sanity_complete excluding UNIV interfaces: the following is not covered: {0.0.0.0 .. 9.255.255.255} u {11.0.0.0 .. 172.16.255.255} u {172.18.0.0 .. 255.255.255.255}
Spoofing certification results:
("docker0","Probably not (False)")
("br-b74b417b331f","True (certified)")
== calculating service matrices ==
=========== TCP port 10000->22 =========
a |-> {0.0.0.0 .. 9.255.255.255} u {11.0.0.0 .. 255.255.255.255}
b |-> 10.0.0.4
c |-> 10.0.0.3
d |-> 10.0.0.2
e |-> 10.0.0.1
f |-> 10.0.0.0 u {10.0.0.5 .. 10.255.255.255}

(a,a)
(a,b)
(a,c)
(a,d)
(a,e)
(a,f)
(b,a)
(b,b)
(b,c)
(b,d)
(b,e)
(b,f)
(c,b)
(c,c)
(c,d)
(d,d)
(e,b)
(e,d)
(e,e)


isabelle gives the same results. Here is what is also allowed to be ESTABLISHED
"([(''0.0.0.0'', ''{0.0.0.0 .. 9.255.255.255} u 10.0.0.1 u {11.0.0.0 .. 255.255.255.255}''),
   (''10.0.0.4'', ''10.0.0.4''),
   (''10.0.0.3'', ''10.0.0.3''),
   (''10.0.0.2'', ''10.0.0.2''),
   (''10.0.0.0'', ''10.0.0.0 u {10.0.0.5 .. 10.255.255.255}'')],
   
  [(''0.0.0.0'', ''0.0.0.0''),
   (''0.0.0.0'', ''10.0.0.4''),
   (''0.0.0.0'', ''10.0.0.3''),
   (''0.0.0.0'', ''10.0.0.2''),
   (''0.0.0.0'', ''10.0.0.0''),
   (''10.0.0.4'', ''0.0.0.0''),
   (''10.0.0.4'', ''10.0.0.4''),
   (''10.0.0.4'', ''10.0.0.3''),
   (''10.0.0.4'', ''10.0.0.2''),
   (''10.0.0.4'', ''10.0.0.0''),
   (''10.0.0.3'', ''10.0.0.4''),
   (''10.0.0.3'', ''10.0.0.3''),
   (''10.0.0.3'', ''10.0.0.2''),
   (''10.0.0.2'', ''10.0.0.2'')])"
  :: "(char list × char list) list × (char list × char list) list"

Yes, this is correct! interestingly, 10.0.0.1 is grouped to the Internet. Well, once established, it basically has the same access rights.
The only additional flow is is that 10.0.0.1 (WebFRNT) has an arrow to the Internet.
Interestingly, WebFRNT is grouped togther with the Internet in one node. Considering established connections, The Internet has indeed the same access rights as WebFrnt!!



just for documentation, once all machines have started:
$ sudo docker network inspect mynet
[sudo] password for corny: 
[
    {
        "Name": "mynet",
        "Id": "b74b417b331fd5bccf2884750f090630740d3581475a61eba29b04f59334f270",
        "Scope": "local",
        "Driver": "bridge",
        "EnableIPv6": false,
        "IPAM": {
            "Driver": "default",
            "Options": {},
            "Config": [
                {
                    "Subnet": "10.0.0.0/8",
                    "Gateway": "10.42.0.100"
                }
            ]
        },
        "Internal": false,
        "Containers": {
            "55fd0bfd60f9457ff28b463d77bb7d094572bda95ebd6017351634092b3f0246": {
                "Name": "db",
                "EndpointID": "d4086a42ad2cc16115a1f381604e944995db20590067c0540fb34f1f0bc095e6",
                "MacAddress": "02:42:0a:00:00:03",
                "IPv4Address": "10.0.0.3/8",
                "IPv6Address": ""
            },
            "6b05d58fbefae569b9ad083f862a4953e9d150ab03eb162831c7e45534f4d450": {
                "Name": "webfrnt",
                "EndpointID": "fbbd3331356895ef76c946d2030402c10af363b13465af905ec32a9ebb6d06ca",
                "MacAddress": "02:42:0a:00:00:01",
                "IPv4Address": "10.0.0.1/8",
                "IPv6Address": ""
            },
            "a85898114fa9bb0c16d711f0a85e1c559ef0164bac5f5826c3cde5ce1d536e61": {
                "Name": "log",
                "EndpointID": "e202591baa933127be9b681eed857c4e0975474d937b03a6c0397e148bf9a853",
                "MacAddress": "02:42:0a:00:00:02",
                "IPv4Address": "10.0.0.2/8",
                "IPv6Address": ""
            },
            "fffcfb8930f709238d1ce8bceb27c0150778d22edf8f020bdc41b0a5e3d36a50": {
                "Name": "webapp",
                "EndpointID": "2f4c5d3144c812c405638d475e11ecf7a84fb20709101269bf80c28fb800f0f0",
                "MacAddress": "02:42:0a:00:00:04",
                "IPv4Address": "10.0.0.4/8",
                "IPv6Address": ""
            }
        },
        "Options": {
            "com.docker.network.bridge.enable_icc": "false"
        },
        "Labels": {}
    }
]







---- 24.11.2016 neues containern: mehr devices adden einself ---



story: firewall has evoled. Too much pinging of heise.de (193.99.144.80), added rate limiting

# Generated by iptables-save v1.6.0 on Thu Sep 15 13:42:24 2016
*nat
:PREROUTING ACCEPT [6:444]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [63:3924]
:POSTROUTING ACCEPT [22:1376]
:DOCKER - [0:0]
-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER
-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER
-A POSTROUTING -s 10.0.0.0/8 ! -o br-b74b417b331f -j MASQUERADE
-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE
-A DOCKER -i br-b74b417b331f -j RETURN
-A DOCKER -i docker0 -j RETURN
COMMIT
# Completed on Thu Sep 15 13:42:24 2016
# Generated by iptables-save v1.6.0 on Thu Sep 15 13:42:24 2016
*filter
:INPUT ACCEPT [184:31271]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [179:18898]
:DOCKER - [0:0]
:DOCKER-ISOLATION - [0:0]
:MYNET - [0:0]
-A FORWARD -j DOCKER-ISOLATION
-A FORWARD -d 193.99.144.80 -m recent --set --name rateheise --rsource
-A FORWARD -d 193.99.144.80 -m recent --update --seconds 60 --hitcount 3 --name rateheise --rsource -j DROP
-A FORWARD -j MYNET
-A FORWARD -o br-b74b417b331f -j DOCKER
-A FORWARD -o br-b74b417b331f -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i br-b74b417b331f ! -o br-b74b417b331f -j ACCEPT
-A FORWARD -o docker0 -j DOCKER
-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i docker0 ! -o docker0 -j ACCEPT
-A FORWARD -i docker0 -o docker0 -j ACCEPT
-A FORWARD -i br-b74b417b331f -o br-b74b417b331f -j DROP
-A DOCKER-ISOLATION -i docker0 -o br-b74b417b331f -j DROP
-A DOCKER-ISOLATION -i br-b74b417b331f -o docker0 -j DROP
-A DOCKER-ISOLATION -j RETURN
-A MYNET -m state --state ESTABLISHED ! -i br-b74b417b331f -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT
-A MYNET -m state --state ESTABLISHED -i br-b74b417b331f -s 10.0.0.1 ! -o br-b74b417b331f -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.1 -o br-b74b417b331f -d 10.0.0.1 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.1 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.1 -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.3 -o br-b74b417b331f -d 10.0.0.3 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.3 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.3 -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.2 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.1 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.3 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.4 ! -o br-b74b417b331f -j ACCEPT
-A MYNET ! -i br-b74b417b331f -o br-b74b417b331f -d 10.0.0.1 -j ACCEPT
-A MYNET -i br-b74b417b331f -j DROP
COMMIT
# Completed on Thu Sep 15 13:42:24 2016



diff:
 :DOCKER-ISOLATION - [0:0]
 :MYNET - [0:0]
 -A FORWARD -j DOCKER-ISOLATION
+-A FORWARD -d 193.99.144.80 -m recent --set --name rateheise --rsource
+-A FORWARD -d 193.99.144.80 -m recent --update --seconds 60 --hitcount 3 --name rateheise --rsource -j DROP
 -A FORWARD -j MYNET
 -A FORWARD -o br-b74b417b331f -j DOCKER
 -A FORWARD -o br-b74b417b331f -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT






tuned: constrain access from and to the docker network from internal

# Generated by iptables-save v1.6.0 on Thu Sep 15 13:42:24 2016
*nat
:PREROUTING ACCEPT [6:444]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [63:3924]
:POSTROUTING ACCEPT [22:1376]
:DOCKER - [0:0]
-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER
-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER
-A POSTROUTING -s 10.0.0.0/8 ! -o br-b74b417b331f -j MASQUERADE
-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE
-A DOCKER -i br-b74b417b331f -j RETURN
-A DOCKER -i docker0 -j RETURN
COMMIT
# Completed on Thu Sep 15 13:42:24 2016
# Generated by iptables-save v1.6.0 on Thu Sep 15 13:42:24 2016
*filter
:INPUT ACCEPT [184:31271]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [179:18898]
:DOCKER - [0:0]
:DOCKER-ISOLATION - [0:0]
:MYNET - [0:0]
-A FORWARD -j DOCKER-ISOLATION
-A FORWARD -d 193.99.144.80 -m recent --set --name rateheise --rsource
-A FORWARD -d 193.99.144.80 -m recent --update --seconds 60 --hitcount 3 --name rateheise --rsource -j DROP
-A FORWARD -j MYNET
-A FORWARD -o br-b74b417b331f -j DOCKER
-A FORWARD -o br-b74b417b331f -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i br-b74b417b331f ! -o br-b74b417b331f -j ACCEPT
-A FORWARD -o docker0 -j DOCKER
-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i docker0 ! -o docker0 -j ACCEPT
-A FORWARD -i docker0 -o docker0 -j ACCEPT
-A FORWARD -i br-b74b417b331f -o br-b74b417b331f -j DROP
-A DOCKER-ISOLATION -i docker0 -o br-b74b417b331f -j DROP
-A DOCKER-ISOLATION -i br-b74b417b331f -o docker0 -j DROP
-A DOCKER-ISOLATION -j RETURN
-A MYNET -m state --state ESTABLISHED ! -i br-b74b417b331f -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT
-A MYNET -m state --state ESTABLISHED -i br-b74b417b331f -s 10.0.0.1 ! -o br-b74b417b331f -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.1 -o br-b74b417b331f -d 10.0.0.1 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.1 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.1 -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.3 -o br-b74b417b331f -d 10.0.0.3 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.3 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.3 -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.2 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.1 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.3 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT
-A MYNET -i br-b74b417b331f -s 10.0.0.4 ! -o br-b74b417b331f ! -d 10.0.0.0/8 -j ACCEPT
-A MYNET ! -i br-b74b417b331f ! -s 10.0.0.0/8 -o br-b74b417b331f -d 10.0.0.1 -j ACCEPT
-A MYNET -i br-b74b417b331f -j DROP
-A MYNET -o br-b74b417b331f -j DROP
-A MYNET -s 10.0.0.0/8 -j DROP
-A MYNET -d 10.0.0.0/8 -j DROP
COMMIT
# Completed on Thu Sep 15 13:42:24 2016

diff

 -A MYNET -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.3 -j ACCEPT
 -A MYNET -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT
 -A MYNET -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT
--A MYNET -i br-b74b417b331f -s 10.0.0.4 ! -o br-b74b417b331f -j ACCEPT
--A MYNET ! -i br-b74b417b331f -o br-b74b417b331f -d 10.0.0.1 -j ACCEPT
+-A MYNET -i br-b74b417b331f -s 10.0.0.4 ! -o br-b74b417b331f ! -d 10.0.0.0/8 -j ACCEPT
+-A MYNET ! -i br-b74b417b331f ! -s 10.0.0.0/8 -o br-b74b417b331f -d 10.0.0.1 -j ACCEPT
 -A MYNET -i br-b74b417b331f -j DROP
+-A MYNET -o br-b74b417b331f -j DROP
+-A MYNET -s 10.0.0.0/8 -j DROP
+-A MYNET -d 10.0.0.0/8 -j DROP
 COMMIT

$ ./dist/build/fffuu/fffuu --ipassmt ipassmt_docker dockermynet3
Parsed IpAssmt
IpAssmt [(docker0,Pos [172.17.0.1/16]),(br-b74b417b331f,Pos [10.0.0.0/8])]
== Checking which tables are supported for analysis. Usually, only `filter'. ==
sanity_wf_ruleset passed
Parsed 6 chains in table filter, a total of 34 rules
Table `nat' caught exception: `Reading ruleset failed! sanity_wf_ruleset check failed.'. Analysis not possible for this table. This is probably due to unsupportd actions (or a bug in the parser).
== Transformed to Isabelle type (only filter table) ==
== unfolded FORWARD chain (upper closure) ==
sanity_wf_ruleset passed
(-o br-b74b417b331f -i docker0, -j DROP)
(-o docker0 -i br-b74b417b331f, -j DROP)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.4/32 -m state --state ESTABLISHED, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -s 10.0.0.1/32 -m state --state ESTABLISHED, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.1/32 -s 10.0.0.1/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.1/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.4/32 -s 10.0.0.1/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.3/32 -s 10.0.0.3/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.3/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.4/32 -s 10.0.0.3/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.2/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.1/32 -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.3/32 -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.4/32 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 0.0.0.0/5 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 8.0.0.0/7 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 11.0.0.0/8 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 12.0.0.0/6 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 16.0.0.0/4 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 32.0.0.0/3 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 64.0.0.0/2 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 128.0.0.0/1 -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 0.0.0.0/5, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 8.0.0.0/7, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 11.0.0.0/8, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 12.0.0.0/6, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 16.0.0.0/4, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 32.0.0.0/3, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 64.0.0.0/2, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 128.0.0.0/1, -j ACCEPT)
(-i br-b74b417b331f, -j DROP)
(-o br-b74b417b331f, -j DROP)
(-s 10.0.0.0/8, -j DROP)
(-d 10.0.0.0/8, -j DROP)
(-o br-b74b417b331f -m state --state ESTABLISHED,RELATED, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f, -j ACCEPT)
(-o docker0 -m state --state ESTABLISHED,RELATED, -j ACCEPT)
(! -o docker0 -i docker0, -j ACCEPT)
(-o docker0 -i docker0, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f, -j DROP)
(, -j ACCEPT)
== to simple firewall ==
DROP     all  --  0.0.0.0/0            0.0.0.0/0 in: docker0 out: br-b74b417b331f  
DROP     all  --  0.0.0.0/0            0.0.0.0/0 in: br-b74b417b331f out: docker0  
ACCEPT     all  --  10.0.0.1/32            10.0.0.1/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.1/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.1/32            10.0.0.4/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.3/32            10.0.0.3/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.3/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.3/32            10.0.0.4/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.2/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.1/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.3/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.4/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            0.0.0.0/5 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            8.0.0.0/7 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            11.0.0.0/8 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            12.0.0.0/6 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            16.0.0.0/4 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            32.0.0.0/3 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            64.0.0.0/2 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            128.0.0.0/1 in: br-b74b417b331f   
ACCEPT     all  --  0.0.0.0/5            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  8.0.0.0/7            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  11.0.0.0/8            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  12.0.0.0/6            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  16.0.0.0/4            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  32.0.0.0/3            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  64.0.0.0/2            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  128.0.0.0/1            10.0.0.1/32  out: br-b74b417b331f  
DROP     all  --  0.0.0.0/0            0.0.0.0/0 in: br-b74b417b331f   
DROP     all  --  0.0.0.0/0            0.0.0.0/0  out: br-b74b417b331f  
DROP     all  --  10.0.0.0/8            0.0.0.0/0    
DROP     all  --  0.0.0.0/0            10.0.0.0/8    
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0 in: br-b74b417b331f   
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0 in: docker0   
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0 in: docker0 out: docker0  
DROP     all  --  0.0.0.0/0            0.0.0.0/0 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0    
== to even-simpler firewall ==
ACCEPT     all  --  10.0.0.1/32            10.0.0.1/32    
ACCEPT     all  --  10.0.0.1/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.1/32            10.0.0.4/32    
ACCEPT     all  --  10.0.0.3/32            10.0.0.3/32    
ACCEPT     all  --  10.0.0.3/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.3/32            10.0.0.4/32    
ACCEPT     all  --  10.0.0.2/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.1/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.3/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.4/32    
ACCEPT     all  --  10.0.0.4/32            0.0.0.0/5    
ACCEPT     all  --  10.0.0.4/32            8.0.0.0/7    
ACCEPT     all  --  10.0.0.4/32            11.0.0.0/8    
ACCEPT     all  --  10.0.0.4/32            12.0.0.0/6    
ACCEPT     all  --  10.0.0.4/32            16.0.0.0/4    
ACCEPT     all  --  10.0.0.4/32            32.0.0.0/3    
ACCEPT     all  --  10.0.0.4/32            64.0.0.0/2    
ACCEPT     all  --  10.0.0.4/32            128.0.0.0/1    
ACCEPT     all  --  0.0.0.0/5            10.0.0.1/32    
ACCEPT     all  --  8.0.0.0/7            10.0.0.1/32    
ACCEPT     all  --  11.0.0.0/8            10.0.0.1/32    
ACCEPT     all  --  12.0.0.0/6            10.0.0.1/32    
ACCEPT     all  --  16.0.0.0/4            10.0.0.1/32    
ACCEPT     all  --  32.0.0.0/3            10.0.0.1/32    
ACCEPT     all  --  64.0.0.0/2            10.0.0.1/32    
ACCEPT     all  --  128.0.0.0/1            10.0.0.1/32    
DROP     all  --  10.0.0.0/8            0.0.0.0/0    
DROP     all  --  0.0.0.0/0            10.0.0.0/8    
ACCEPT     all  --  10.0.0.0/8            0.0.0.0/0    
ACCEPT     all  --  172.17.0.0/16            0.0.0.0/0    
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0    
== checking spoofing protection ==
distinct: passed
ipassmt_sanity_nowildcards: passed
ipassmt_sanity_defined (interfaces defined in the ruleset are also in ipassmt): passed
ipassmt_sanity_disjoint (no zone-spanning interfaces): passed
ipassmt_sanity_disjoint excluding UNIV interfaces: passed
ipassmt_sanity_complete: the following is not covered: {0.0.0.0 .. 9.255.255.255} u {11.0.0.0 .. 172.16.255.255} u {172.18.0.0 .. 255.255.255.255}
ipassmt_sanity_complete excluding UNIV interfaces: the following is not covered: {0.0.0.0 .. 9.255.255.255} u {11.0.0.0 .. 172.16.255.255} u {172.18.0.0 .. 255.255.255.255}
Spoofing certification results:
("docker0","Probably not (False)")
("br-b74b417b331f","True (certified)")
== calculating service matrices ==
=========== TCP port 10000->22 =========
a |-> {0.0.0.0 .. 9.255.255.255} u {11.0.0.0 .. 255.255.255.255}
b |-> 10.0.0.4
c |-> 10.0.0.3
d |-> 10.0.0.2
e |-> 10.0.0.1
f |-> 10.0.0.0 u {10.0.0.5 .. 10.255.255.255}

(a,a)
(a,e)
(b,a)
(b,b)
(b,c)
(b,d)
(b,e)
(c,b)
(c,c)
(c,d)
(d,d)
(e,b)
(e,d)
(e,e)



we see: smaller service matrix!!
(docker connectivity tested, still as expected and corresponding to matrix)
























next part of story:
ssh access was allowed for all machines
also: 10.0.0.2 (log) may access a status page of 10.0.0.1 (webfrnt) over HTTP
story: only temporary

# Generated by iptables-save v1.6.0 on Thu Nov 24 16:15:19 2016
*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [4:304]
:POSTROUTING ACCEPT [0:0]
:DOCKER - [0:0]
-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER
-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER
-A POSTROUTING -s 10.0.0.0/8 ! -o br-b74b417b331f -j MASQUERADE
-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE
-A DOCKER -i br-b74b417b331f -j RETURN
-A DOCKER -i docker0 -j RETURN
COMMIT
# Completed on Thu Nov 24 16:15:19 2016
# Generated by iptables-save v1.6.0 on Thu Nov 24 16:15:19 2016
*filter
:INPUT ACCEPT [3:228]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [4:304]
:DOCKER - [0:0]
:DOCKER-ISOLATION - [0:0]
:MYNET - [0:0]
-A FORWARD -j DOCKER-ISOLATION
-A FORWARD -d 193.99.144.80/32 -m recent --set --name rateheise --mask 255.255.255.255 --rsource
-A FORWARD -d 193.99.144.80/32 -m recent --update --seconds 60 --hitcount 3 --name rateheise --mask 255.255.255.255 --rsource -j DROP
-A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -p tcp -m tcp --dport 22 -j ACCEPT
-A FORWARD -s 10.0.0.2/32 -d 10.0.0.1/32 -p tcp -m tcp --dport 80 -j ACCEPT
-A FORWARD -j MYNET
-A FORWARD -o br-b74b417b331f -j DOCKER
-A FORWARD -o br-b74b417b331f -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i br-b74b417b331f ! -o br-b74b417b331f -j ACCEPT
-A FORWARD -o docker0 -j DOCKER
-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i docker0 ! -o docker0 -j ACCEPT
-A FORWARD -i docker0 -o docker0 -j ACCEPT
-A FORWARD -i br-b74b417b331f -o br-b74b417b331f -j DROP
-A DOCKER-ISOLATION -i docker0 -o br-b74b417b331f -j DROP
-A DOCKER-ISOLATION -i br-b74b417b331f -o docker0 -j DROP
-A DOCKER-ISOLATION -j RETURN
-A MYNET -d 10.0.0.4/32 ! -i br-b74b417b331f -o br-b74b417b331f -m state --state ESTABLISHED -j ACCEPT
-A MYNET -s 10.0.0.1/32 -i br-b74b417b331f ! -o br-b74b417b331f -m state --state ESTABLISHED -j ACCEPT
-A MYNET -s 10.0.0.1/32 -d 10.0.0.1/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A MYNET -s 10.0.0.1/32 -d 10.0.0.2/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A MYNET -s 10.0.0.1/32 -d 10.0.0.4/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A MYNET -s 10.0.0.3/32 -d 10.0.0.3/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A MYNET -s 10.0.0.3/32 -d 10.0.0.2/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A MYNET -s 10.0.0.3/32 -d 10.0.0.4/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A MYNET -s 10.0.0.2/32 -d 10.0.0.2/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A MYNET -s 10.0.0.4/32 -d 10.0.0.1/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A MYNET -s 10.0.0.4/32 -d 10.0.0.3/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A MYNET -s 10.0.0.4/32 -d 10.0.0.2/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A MYNET -s 10.0.0.4/32 -d 10.0.0.4/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A MYNET -s 10.0.0.4/32 ! -d 10.0.0.0/8 -i br-b74b417b331f ! -o br-b74b417b331f -j ACCEPT
-A MYNET ! -s 10.0.0.0/8 -d 10.0.0.1/32 ! -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A MYNET -i br-b74b417b331f -j DROP
-A MYNET -o br-b74b417b331f -j DROP
-A MYNET -s 10.0.0.0/8 -j DROP
-A MYNET -d 10.0.0.0/8 -j DROP
COMMIT
# Completed on Thu Nov 24 16:15:19 2016


diff:
 -A FORWARD -j DOCKER-ISOLATION
 -A FORWARD -d 193.99.144.80 -m recent --set --name rateheise --rsource
 -A FORWARD -d 193.99.144.80 -m recent --update --seconds 60 --hitcount 3 --name rateheise --rsource -j DROP
+-A FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT
+-A FORWARD -p tcp --dport 22 -j ACCEPT
+-A FORWARD -s 10.0.0.2 -d 10.0.0.1 -p tcp --dport 80 -j ACCEPT
 -A FORWARD -j MYNET
 -A FORWARD -o br-b74b417b331f -j DOCKER
 -A FORWARD -o br-b74b417b331f -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT


docker connectivity checked: can ssh between all containers,
only additional http between one and two (not even ping between the two)

fffuu tells about different connectivity for ssh and http


$ ./dist/build/fffuu/fffuu --ipassmt ipassmt_docker dockermynet4
Parsed IpAssmt
IpAssmt [(docker0,Pos [172.17.0.1/16]),(br-b74b417b331f,Pos [10.0.0.0/8])]
== Checking which tables are supported for analysis. Usually, only `filter'. ==
sanity_wf_ruleset passed
Parsed 6 chains in table filter, a total of 37 rules
Table `nat' caught exception: `Reading ruleset failed! sanity_wf_ruleset check failed.'. Analysis not possible for this table. This is probably due to unsupportd actions (or a bug in the parser).
== Transformed to Isabelle type (only filter table) ==
== unfolded FORWARD chain (upper closure) ==
sanity_wf_ruleset passed
(-o br-b74b417b331f -i docker0, -j DROP)
(-o docker0 -i br-b74b417b331f, -j DROP)
(-m state --state ESTABLISHED,RELATED, -j ACCEPT)
(-p tcp -m tcp --dpts [22], -j ACCEPT)
(-p tcp -m tcp --dpts [80] -d 10.0.0.1/32 -s 10.0.0.2/32, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.4/32 -m state --state ESTABLISHED, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -s 10.0.0.1/32 -m state --state ESTABLISHED, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.1/32 -s 10.0.0.1/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.1/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.4/32 -s 10.0.0.1/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.3/32 -s 10.0.0.3/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.3/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.4/32 -s 10.0.0.3/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.2/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.1/32 -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.3/32 -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.4/32 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 0.0.0.0/5 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 8.0.0.0/7 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 11.0.0.0/8 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 12.0.0.0/6 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 16.0.0.0/4 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 32.0.0.0/3 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 64.0.0.0/2 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 128.0.0.0/1 -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 0.0.0.0/5, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 8.0.0.0/7, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 11.0.0.0/8, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 12.0.0.0/6, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 16.0.0.0/4, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 32.0.0.0/3, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 64.0.0.0/2, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 128.0.0.0/1, -j ACCEPT)
(-i br-b74b417b331f, -j DROP)
(-o br-b74b417b331f, -j DROP)
(-s 10.0.0.0/8, -j DROP)
(-d 10.0.0.0/8, -j DROP)
(-o br-b74b417b331f -m state --state ESTABLISHED,RELATED, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f, -j ACCEPT)
(-o docker0 -m state --state ESTABLISHED,RELATED, -j ACCEPT)
(! -o docker0 -i docker0, -j ACCEPT)
(-o docker0 -i docker0, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f, -j DROP)
(, -j ACCEPT)
== to simple firewall ==
DROP     all  --  0.0.0.0/0            0.0.0.0/0 in: docker0 out: br-b74b417b331f  
DROP     all  --  0.0.0.0/0            0.0.0.0/0 in: br-b74b417b331f out: docker0  
ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0    dports: 22
ACCEPT     tcp  --  10.0.0.2/32            10.0.0.1/32    dports: 80
ACCEPT     all  --  10.0.0.1/32            10.0.0.1/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.1/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.1/32            10.0.0.4/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.3/32            10.0.0.3/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.3/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.3/32            10.0.0.4/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.2/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.1/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.3/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.4/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            0.0.0.0/5 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            8.0.0.0/7 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            11.0.0.0/8 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            12.0.0.0/6 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            16.0.0.0/4 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            32.0.0.0/3 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            64.0.0.0/2 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            128.0.0.0/1 in: br-b74b417b331f   
ACCEPT     all  --  0.0.0.0/5            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  8.0.0.0/7            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  11.0.0.0/8            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  12.0.0.0/6            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  16.0.0.0/4            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  32.0.0.0/3            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  64.0.0.0/2            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  128.0.0.0/1            10.0.0.1/32  out: br-b74b417b331f  
DROP     all  --  0.0.0.0/0            0.0.0.0/0 in: br-b74b417b331f   
DROP     all  --  0.0.0.0/0            0.0.0.0/0  out: br-b74b417b331f  
DROP     all  --  10.0.0.0/8            0.0.0.0/0    
DROP     all  --  0.0.0.0/0            10.0.0.0/8    
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0 in: br-b74b417b331f   
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0 in: docker0   
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0 in: docker0 out: docker0  
DROP     all  --  0.0.0.0/0            0.0.0.0/0 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0    
== to even-simpler firewall ==
ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0    dports: 22
ACCEPT     tcp  --  10.0.0.2/32            10.0.0.1/32    dports: 80
ACCEPT     all  --  10.0.0.1/32            10.0.0.1/32    
ACCEPT     all  --  10.0.0.1/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.1/32            10.0.0.4/32    
ACCEPT     all  --  10.0.0.3/32            10.0.0.3/32    
ACCEPT     all  --  10.0.0.3/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.3/32            10.0.0.4/32    
ACCEPT     all  --  10.0.0.2/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.1/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.3/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.4/32    
ACCEPT     all  --  10.0.0.4/32            0.0.0.0/5    
ACCEPT     all  --  10.0.0.4/32            8.0.0.0/7    
ACCEPT     all  --  10.0.0.4/32            11.0.0.0/8    
ACCEPT     all  --  10.0.0.4/32            12.0.0.0/6    
ACCEPT     all  --  10.0.0.4/32            16.0.0.0/4    
ACCEPT     all  --  10.0.0.4/32            32.0.0.0/3    
ACCEPT     all  --  10.0.0.4/32            64.0.0.0/2    
ACCEPT     all  --  10.0.0.4/32            128.0.0.0/1    
ACCEPT     all  --  0.0.0.0/5            10.0.0.1/32    
ACCEPT     all  --  8.0.0.0/7            10.0.0.1/32    
ACCEPT     all  --  11.0.0.0/8            10.0.0.1/32    
ACCEPT     all  --  12.0.0.0/6            10.0.0.1/32    
ACCEPT     all  --  16.0.0.0/4            10.0.0.1/32    
ACCEPT     all  --  32.0.0.0/3            10.0.0.1/32    
ACCEPT     all  --  64.0.0.0/2            10.0.0.1/32    
ACCEPT     all  --  128.0.0.0/1            10.0.0.1/32    
DROP     all  --  10.0.0.0/8            0.0.0.0/0    
DROP     all  --  0.0.0.0/0            10.0.0.0/8    
ACCEPT     all  --  10.0.0.0/8            0.0.0.0/0    
ACCEPT     all  --  172.17.0.0/16            0.0.0.0/0    
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0    
== checking spoofing protection ==
distinct: passed
ipassmt_sanity_nowildcards: passed
ipassmt_sanity_defined (interfaces defined in the ruleset are also in ipassmt): passed
ipassmt_sanity_disjoint (no zone-spanning interfaces): passed
ipassmt_sanity_disjoint excluding UNIV interfaces: passed
ipassmt_sanity_complete: the following is not covered: {0.0.0.0 .. 9.255.255.255} u {11.0.0.0 .. 172.16.255.255} u {172.18.0.0 .. 255.255.255.255}
ipassmt_sanity_complete excluding UNIV interfaces: the following is not covered: {0.0.0.0 .. 9.255.255.255} u {11.0.0.0 .. 172.16.255.255} u {172.18.0.0 .. 255.255.255.255}
Spoofing certification results:
("docker0","Probably not (False)")
("br-b74b417b331f","Probably not (False)")
== calculating service matrices ==
=========== TCP port 10000->22 =========
a |-> {0.0.0.0 .. 255.255.255.255}

(a,a)

=========== TCP port 10000->80 =========
a |-> {0.0.0.0 .. 9.255.255.255} u {11.0.0.0 .. 255.255.255.255}
b |-> 10.0.0.4
c |-> 10.0.0.3
d |-> 10.0.0.2
e |-> 10.0.0.1
f |-> 10.0.0.0 u {10.0.0.5 .. 10.255.255.255}

(a,a)
(a,e)
(b,a)
(b,b)
(b,c)
(b,d)
(b,e)
(c,b)
(c,c)
(c,d)
(d,d)
(d,e)
(e,b)
(e,d)
(e,e)




okay, iptables rules have --due to hot fixes-- diverged from actual requirements

loading to \topos{}

dockermynet4policy.pdf shows an immediate violation


--start isabelle
(*dockermynet4*)
definition dockermynet4policy :: "string list_graph" where
    "dockermynet4policy ≡ ⦇ nodesL = [''WebFrnt'', ''DB'', ''Log'', ''WebApp'', ''INET''],
                edgesL = [(''INET'',''INET''),
                          (''INET'',''WebFrnt''),
                          (''WebApp'',''INET''),
                          (''WebApp'',''WebApp''),
                          (''WebApp'',''DB''),
                          (''WebApp'',''Log''),
                          (''WebApp'',''WebFrnt''),
                          (''DB'',''WebApp''),
                          (''DB'',''DB''),
                          (''DB'',''Log''),
                          (''Log'',''Log''),
                          (''Log'',''WebFrnt''),
                          (''WebFrnt'',''WebApp''),
                          (''WebFrnt'',''Log''),
                          (''WebFrnt'',''WebFrnt'')] ⦈"

lemma "wf_list_graph dockermynet4policy" by eval

ML{*
visualize_graph @{context} @{term "security_invariants"} @{term "dockermynet4policy"};
*}

ML_val{*
writeln ("*filter"^"\n"^
         ":INPUT ACCEPT [0:0]"^"\n"^
         ":FORWARD DROP [0:0]"^"\n"^
         ":OUTPUT ACCEPT [0:0]"^"\n");

fun mkiface s = if s = "INET" then "INET_iface" else "br-b74b417b331f";

iterate_edges_ML @{context}  @{term "flows_fixL (generate_valid_stateful_policy_IFSACS max_policy security_invariants)"}
  (fn (v1,v2) => writeln ("-A FORWARD -i "^mkiface v1^" -s $"^v1^"_ipv4 -o "^mkiface v2^" -d $"^v2^"_ipv4 -j ACCEPT") )
  (fn _ => () )
  (fn _ => () );

iterate_edges_ML @{context} @{term "flows_stateL (generate_valid_stateful_policy_IFSACS max_policy security_invariants)"}
  (fn (v1,v2) => writeln ("-I FORWARD -m state --state ESTABLISHED -i "^mkiface v2^" -s $"^v2^"_ipv4 -o "^mkiface v1^" -d $"^v1^"_ipv4 -j ACCEPT") )
  (fn _ => () )
  (fn _ => () );

writeln ("COMMIT"^"\n");
*}
---end isabelle





stroy: too much load on WebFrnt, need to spawn an additional node
docker run --rm -ti --name webfrnt2 --hostname webfrnt2 --net mynet --ip 10.0.0.42 busybox
okay, it got too unwieldy to manage iptables by hand!


let topos generate it from scratch.
All containers attached to the br-b74b417b331f interface.
Only need to fill in IP addresses and the Interface of the uplink to the Internet.

*filter
:INPUT ACCEPT [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]
-A FORWARD -i br-b74b417b331f -s $WebFrnt_ipv4 -o br-b74b417b331f -d $WebFrnt_ipv4 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s $WebFrnt_ipv4 -o br-b74b417b331f -d $Log_ipv4 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s $WebFrnt_ipv4 -o br-b74b417b331f -d $WebApp_ipv4 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s $WebFrnt_ipv4 -o $INET_iface -d $INET_ipv4 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s $DB_ipv4 -o br-b74b417b331f -d $DB_ipv4 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s $DB_ipv4 -o br-b74b417b331f -d $Log_ipv4 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s $DB_ipv4 -o br-b74b417b331f -d $WebApp_ipv4 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s $Log_ipv4 -o br-b74b417b331f -d $Log_ipv4 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s $WebApp_ipv4 -o br-b74b417b331f -d $WebFrnt_ipv4 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s $WebApp_ipv4 -o br-b74b417b331f -d $DB_ipv4 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s $WebApp_ipv4 -o br-b74b417b331f -d $Log_ipv4 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s $WebApp_ipv4 -o br-b74b417b331f -d $WebApp_ipv4 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s $WebApp_ipv4 -o $INET_iface -d $INET_ipv4 -j ACCEPT 
-A FORWARD -i $INET_iface -s $INET_ipv4 -o br-b74b417b331f -d $WebFrnt_ipv4 -j ACCEPT 
-A FORWARD -i $INET_iface -s $INET_ipv4 -o $INET_iface -d $INET_ipv4 -j ACCEPT 
-I FORWARD -m state --state ESTABLISHED -i $INET_iface -s $INET_ipv4 -o br-b74b417b331f -d $WebApp_ipv4 -j ACCEPT 
COMMIT



Here are the rules:

again: INET interface and iprange is simply "not the docker range"

what I write:
*filter
:INPUT ACCEPT [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]
-A FORWARD -i br-b74b417b331f -s 10.0.0.1,10.0.0.42 -o br-b74b417b331f -d 10.0.0.1,10.0.0.42 -j ACCEPT
-A FORWARD -i br-b74b417b331f -s 10.0.0.1,10.0.0.42 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT
-A FORWARD -i br-b74b417b331f -s 10.0.0.1,10.0.0.42 -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT
-A FORWARD -i br-b74b417b331f -s 10.0.0.1,10.0.0.42 ! -o br-b74b417b331f -m iprange ! --dst-range 10.0.0.0-10.255.255.255 -j ACCEPT
-A FORWARD -i br-b74b417b331f -s 10.0.0.3 -o br-b74b417b331f -d 10.0.0.3 -j ACCEPT
-A FORWARD -i br-b74b417b331f -s 10.0.0.3 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT
-A FORWARD -i br-b74b417b331f -s 10.0.0.3 -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT
-A FORWARD -i br-b74b417b331f -s 10.0.0.2 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT
-A FORWARD -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.1,10.0.0.42 -j ACCEPT
-A FORWARD -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.3 -j ACCEPT
-A FORWARD -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT
-A FORWARD -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT
-A FORWARD -i br-b74b417b331f -s 10.0.0.4 ! -o br-b74b417b331f ! -d 10.0.0.0/8 -j ACCEPT
-A FORWARD ! -i br-b74b417b331f -m iprange ! --src-range 10.0.0.0-10.255.255.255 -o br-b74b417b331f -d 10.0.0.1,10.0.0.42 -j ACCEPT
-A FORWARD ! -i br-b74b417b331f ! -s 10.0.0.0/8 ! -o br-b74b417b331f ! -d 10.0.0.0/8 -j ACCEPT
-I FORWARD -m state --state ESTABLISHED ! -i br-b74b417b331f ! -s 10.0.0.0/8 -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT
COMMIT


what the kernel loads:

COMMIT
# Completed on Thu Nov 24 16:46:08 2016
# Generated by iptables-save v1.6.0 on Thu Nov 24 16:46:08 2016
*filter
:INPUT ACCEPT [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]
-A FORWARD ! -s 10.0.0.0/8 -d 10.0.0.4/32 ! -i br-b74b417b331f -o br-b74b417b331f -m state --state ESTABLISHED -j ACCEPT
-A FORWARD -s 10.0.0.1/32 -d 10.0.0.1/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.1/32 -d 10.0.0.42/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.42/32 -d 10.0.0.1/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.42/32 -d 10.0.0.42/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.1/32 -d 10.0.0.2/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.42/32 -d 10.0.0.2/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.1/32 -d 10.0.0.4/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.42/32 -d 10.0.0.4/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.1/32 -i br-b74b417b331f ! -o br-b74b417b331f -m iprange ! --dst-range 10.0.0.0-10.255.255.255 -j ACCEPT
-A FORWARD -s 10.0.0.42/32 -i br-b74b417b331f ! -o br-b74b417b331f -m iprange ! --dst-range 10.0.0.0-10.255.255.255 -j ACCEPT
-A FORWARD -s 10.0.0.3/32 -d 10.0.0.3/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.3/32 -d 10.0.0.2/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.3/32 -d 10.0.0.4/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.2/32 -d 10.0.0.2/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.4/32 -d 10.0.0.1/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.4/32 -d 10.0.0.42/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.4/32 -d 10.0.0.3/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.4/32 -d 10.0.0.2/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.4/32 -d 10.0.0.4/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.4/32 ! -d 10.0.0.0/8 -i br-b74b417b331f ! -o br-b74b417b331f -j ACCEPT
-A FORWARD -d 10.0.0.1/32 ! -i br-b74b417b331f -o br-b74b417b331f -m iprange ! --src-range 10.0.0.0-10.255.255.255 -j ACCEPT
-A FORWARD -d 10.0.0.42/32 ! -i br-b74b417b331f -o br-b74b417b331f -m iprange ! --src-range 10.0.0.0-10.255.255.255 -j ACCEPT
-A FORWARD ! -s 10.0.0.0/8 ! -d 10.0.0.0/8 ! -i br-b74b417b331f ! -o br-b74b417b331f -j ACCEPT
COMMIT
# Completed on Thu Nov 24 16:46:08 2016


connectivity test: success (also for new .42 host)

also: webfrnt can access INET
no longer rate limiting or ssh access





$ ./dist/build/fffuu/fffuu --ipassmt ipassmt_docker dockermynet.topos4 
Parsed IpAssmt
IpAssmt [(docker0,Pos [172.17.0.1/16]),(br-b74b417b331f,Pos [10.0.0.0/8])]
== Checking which tables are supported for analysis. Usually, only `filter'. ==
sanity_wf_ruleset passed
Parsed 3 chains in table filter, a total of 24 rules
== Transformed to Isabelle type (only filter table) ==
== unfolded FORWARD chain (upper closure) ==
sanity_wf_ruleset passed
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.4/32 -s 0.0.0.0/5 -m state --state ESTABLISHED, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.4/32 -s 8.0.0.0/7 -m state --state ESTABLISHED, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.4/32 -s 11.0.0.0/8 -m state --state ESTABLISHED, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.4/32 -s 12.0.0.0/6 -m state --state ESTABLISHED, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.4/32 -s 16.0.0.0/4 -m state --state ESTABLISHED, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.4/32 -s 32.0.0.0/3 -m state --state ESTABLISHED, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.4/32 -s 64.0.0.0/2 -m state --state ESTABLISHED, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.4/32 -s 128.0.0.0/1 -m state --state ESTABLISHED, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.1/32 -s 10.0.0.1/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.42/32 -s 10.0.0.1/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.1/32 -s 10.0.0.42/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.42/32 -s 10.0.0.42/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.1/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.42/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.4/32 -s 10.0.0.1/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.4/32 -s 10.0.0.42/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 0.0.0.0/5 -s 10.0.0.1/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 8.0.0.0/7 -s 10.0.0.1/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 11.0.0.0/8 -s 10.0.0.1/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 12.0.0.0/6 -s 10.0.0.1/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 16.0.0.0/4 -s 10.0.0.1/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 32.0.0.0/3 -s 10.0.0.1/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 64.0.0.0/2 -s 10.0.0.1/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 128.0.0.0/1 -s 10.0.0.1/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 0.0.0.0/5 -s 10.0.0.42/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 8.0.0.0/7 -s 10.0.0.42/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 11.0.0.0/8 -s 10.0.0.42/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 12.0.0.0/6 -s 10.0.0.42/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 16.0.0.0/4 -s 10.0.0.42/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 32.0.0.0/3 -s 10.0.0.42/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 64.0.0.0/2 -s 10.0.0.42/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 128.0.0.0/1 -s 10.0.0.42/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.3/32 -s 10.0.0.3/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.3/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.4/32 -s 10.0.0.3/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.2/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.1/32 -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.42/32 -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.3/32 -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.4/32 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 0.0.0.0/5 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 8.0.0.0/7 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 11.0.0.0/8 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 12.0.0.0/6 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 16.0.0.0/4 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 32.0.0.0/3 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 64.0.0.0/2 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 128.0.0.0/1 -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 0.0.0.0/5, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 8.0.0.0/7, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 11.0.0.0/8, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 12.0.0.0/6, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 16.0.0.0/4, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 32.0.0.0/3, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 64.0.0.0/2, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 128.0.0.0/1, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.42/32 -s 0.0.0.0/5, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.42/32 -s 8.0.0.0/7, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.42/32 -s 11.0.0.0/8, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.42/32 -s 12.0.0.0/6, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.42/32 -s 16.0.0.0/4, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.42/32 -s 32.0.0.0/3, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.42/32 -s 64.0.0.0/2, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.42/32 -s 128.0.0.0/1, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 0.0.0.0/5 -s 0.0.0.0/5, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 8.0.0.0/7 -s 0.0.0.0/5, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 11.0.0.0/8 -s 0.0.0.0/5, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 12.0.0.0/6 -s 0.0.0.0/5, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 16.0.0.0/4 -s 0.0.0.0/5, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 32.0.0.0/3 -s 0.0.0.0/5, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 64.0.0.0/2 -s 0.0.0.0/5, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 128.0.0.0/1 -s 0.0.0.0/5, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 0.0.0.0/5 -s 8.0.0.0/7, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 8.0.0.0/7 -s 8.0.0.0/7, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 11.0.0.0/8 -s 8.0.0.0/7, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 12.0.0.0/6 -s 8.0.0.0/7, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 16.0.0.0/4 -s 8.0.0.0/7, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 32.0.0.0/3 -s 8.0.0.0/7, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 64.0.0.0/2 -s 8.0.0.0/7, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 128.0.0.0/1 -s 8.0.0.0/7, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 0.0.0.0/5 -s 11.0.0.0/8, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 8.0.0.0/7 -s 11.0.0.0/8, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 11.0.0.0/8 -s 11.0.0.0/8, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 12.0.0.0/6 -s 11.0.0.0/8, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 16.0.0.0/4 -s 11.0.0.0/8, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 32.0.0.0/3 -s 11.0.0.0/8, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 64.0.0.0/2 -s 11.0.0.0/8, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 128.0.0.0/1 -s 11.0.0.0/8, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 0.0.0.0/5 -s 12.0.0.0/6, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 8.0.0.0/7 -s 12.0.0.0/6, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 11.0.0.0/8 -s 12.0.0.0/6, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 12.0.0.0/6 -s 12.0.0.0/6, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 16.0.0.0/4 -s 12.0.0.0/6, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 32.0.0.0/3 -s 12.0.0.0/6, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 64.0.0.0/2 -s 12.0.0.0/6, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 128.0.0.0/1 -s 12.0.0.0/6, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 0.0.0.0/5 -s 16.0.0.0/4, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 8.0.0.0/7 -s 16.0.0.0/4, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 11.0.0.0/8 -s 16.0.0.0/4, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 12.0.0.0/6 -s 16.0.0.0/4, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 16.0.0.0/4 -s 16.0.0.0/4, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 32.0.0.0/3 -s 16.0.0.0/4, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 64.0.0.0/2 -s 16.0.0.0/4, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 128.0.0.0/1 -s 16.0.0.0/4, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 0.0.0.0/5 -s 32.0.0.0/3, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 8.0.0.0/7 -s 32.0.0.0/3, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 11.0.0.0/8 -s 32.0.0.0/3, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 12.0.0.0/6 -s 32.0.0.0/3, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 16.0.0.0/4 -s 32.0.0.0/3, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 32.0.0.0/3 -s 32.0.0.0/3, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 64.0.0.0/2 -s 32.0.0.0/3, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 128.0.0.0/1 -s 32.0.0.0/3, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 0.0.0.0/5 -s 64.0.0.0/2, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 8.0.0.0/7 -s 64.0.0.0/2, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 11.0.0.0/8 -s 64.0.0.0/2, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 12.0.0.0/6 -s 64.0.0.0/2, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 16.0.0.0/4 -s 64.0.0.0/2, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 32.0.0.0/3 -s 64.0.0.0/2, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 64.0.0.0/2 -s 64.0.0.0/2, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 128.0.0.0/1 -s 64.0.0.0/2, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 0.0.0.0/5 -s 128.0.0.0/1, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 8.0.0.0/7 -s 128.0.0.0/1, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 11.0.0.0/8 -s 128.0.0.0/1, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 12.0.0.0/6 -s 128.0.0.0/1, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 16.0.0.0/4 -s 128.0.0.0/1, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 32.0.0.0/3 -s 128.0.0.0/1, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 64.0.0.0/2 -s 128.0.0.0/1, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 128.0.0.0/1 -s 128.0.0.0/1, -j ACCEPT)
(, -j DROP)
== to simple firewall ==
ACCEPT     all  --  10.0.0.1/32            10.0.0.1/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.1/32            10.0.0.42/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.42/32            10.0.0.1/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.42/32            10.0.0.42/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.1/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.42/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.1/32            10.0.0.4/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.42/32            10.0.0.4/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.1/32            0.0.0.0/5 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.1/32            8.0.0.0/7 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.1/32            11.0.0.0/8 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.1/32            12.0.0.0/6 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.1/32            16.0.0.0/4 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.1/32            32.0.0.0/3 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.1/32            64.0.0.0/2 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.1/32            128.0.0.0/1 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.42/32            0.0.0.0/5 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.42/32            8.0.0.0/7 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.42/32            11.0.0.0/8 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.42/32            12.0.0.0/6 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.42/32            16.0.0.0/4 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.42/32            32.0.0.0/3 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.42/32            64.0.0.0/2 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.42/32            128.0.0.0/1 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.3/32            10.0.0.3/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.3/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.3/32            10.0.0.4/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.2/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.1/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.42/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.3/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.4/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            0.0.0.0/5 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            8.0.0.0/7 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            11.0.0.0/8 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            12.0.0.0/6 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            16.0.0.0/4 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            32.0.0.0/3 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            64.0.0.0/2 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            128.0.0.0/1 in: br-b74b417b331f   
ACCEPT     all  --  0.0.0.0/5            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  8.0.0.0/7            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  11.0.0.0/8            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  12.0.0.0/6            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  16.0.0.0/4            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  32.0.0.0/3            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  64.0.0.0/2            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  128.0.0.0/1            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  0.0.0.0/5            10.0.0.42/32  out: br-b74b417b331f  
ACCEPT     all  --  8.0.0.0/7            10.0.0.42/32  out: br-b74b417b331f  
ACCEPT     all  --  11.0.0.0/8            10.0.0.42/32  out: br-b74b417b331f  
ACCEPT     all  --  12.0.0.0/6            10.0.0.42/32  out: br-b74b417b331f  
ACCEPT     all  --  16.0.0.0/4            10.0.0.42/32  out: br-b74b417b331f  
ACCEPT     all  --  32.0.0.0/3            10.0.0.42/32  out: br-b74b417b331f  
ACCEPT     all  --  64.0.0.0/2            10.0.0.42/32  out: br-b74b417b331f  
ACCEPT     all  --  128.0.0.0/1            10.0.0.42/32  out: br-b74b417b331f  
ACCEPT     all  --  0.0.0.0/5            0.0.0.0/5    
ACCEPT     all  --  0.0.0.0/5            8.0.0.0/7    
ACCEPT     all  --  0.0.0.0/5            11.0.0.0/8    
ACCEPT     all  --  0.0.0.0/5            12.0.0.0/6    
ACCEPT     all  --  0.0.0.0/5            16.0.0.0/4    
ACCEPT     all  --  0.0.0.0/5            32.0.0.0/3    
ACCEPT     all  --  0.0.0.0/5            64.0.0.0/2    
ACCEPT     all  --  0.0.0.0/5            128.0.0.0/1    
ACCEPT     all  --  8.0.0.0/7            0.0.0.0/5    
ACCEPT     all  --  8.0.0.0/7            8.0.0.0/7    
ACCEPT     all  --  8.0.0.0/7            11.0.0.0/8    
ACCEPT     all  --  8.0.0.0/7            12.0.0.0/6    
ACCEPT     all  --  8.0.0.0/7            16.0.0.0/4    
ACCEPT     all  --  8.0.0.0/7            32.0.0.0/3    
ACCEPT     all  --  8.0.0.0/7            64.0.0.0/2    
ACCEPT     all  --  8.0.0.0/7            128.0.0.0/1    
ACCEPT     all  --  11.0.0.0/8            0.0.0.0/5    
ACCEPT     all  --  11.0.0.0/8            8.0.0.0/7    
ACCEPT     all  --  11.0.0.0/8            11.0.0.0/8    
ACCEPT     all  --  11.0.0.0/8            12.0.0.0/6    
ACCEPT     all  --  11.0.0.0/8            16.0.0.0/4    
ACCEPT     all  --  11.0.0.0/8            32.0.0.0/3    
ACCEPT     all  --  11.0.0.0/8            64.0.0.0/2    
ACCEPT     all  --  11.0.0.0/8            128.0.0.0/1    
ACCEPT     all  --  12.0.0.0/6            0.0.0.0/5    
ACCEPT     all  --  12.0.0.0/6            8.0.0.0/7    
ACCEPT     all  --  12.0.0.0/6            11.0.0.0/8    
ACCEPT     all  --  12.0.0.0/6            12.0.0.0/6    
ACCEPT     all  --  12.0.0.0/6            16.0.0.0/4    
ACCEPT     all  --  12.0.0.0/6            32.0.0.0/3    
ACCEPT     all  --  12.0.0.0/6            64.0.0.0/2    
ACCEPT     all  --  12.0.0.0/6            128.0.0.0/1    
ACCEPT     all  --  16.0.0.0/4            0.0.0.0/5    
ACCEPT     all  --  16.0.0.0/4            8.0.0.0/7    
ACCEPT     all  --  16.0.0.0/4            11.0.0.0/8    
ACCEPT     all  --  16.0.0.0/4            12.0.0.0/6    
ACCEPT     all  --  16.0.0.0/4            16.0.0.0/4    
ACCEPT     all  --  16.0.0.0/4            32.0.0.0/3    
ACCEPT     all  --  16.0.0.0/4            64.0.0.0/2    
ACCEPT     all  --  16.0.0.0/4            128.0.0.0/1    
ACCEPT     all  --  32.0.0.0/3            0.0.0.0/5    
ACCEPT     all  --  32.0.0.0/3            8.0.0.0/7    
ACCEPT     all  --  32.0.0.0/3            11.0.0.0/8    
ACCEPT     all  --  32.0.0.0/3            12.0.0.0/6    
ACCEPT     all  --  32.0.0.0/3            16.0.0.0/4    
ACCEPT     all  --  32.0.0.0/3            32.0.0.0/3    
ACCEPT     all  --  32.0.0.0/3            64.0.0.0/2    
ACCEPT     all  --  32.0.0.0/3            128.0.0.0/1    
ACCEPT     all  --  64.0.0.0/2            0.0.0.0/5    
ACCEPT     all  --  64.0.0.0/2            8.0.0.0/7    
ACCEPT     all  --  64.0.0.0/2            11.0.0.0/8    
ACCEPT     all  --  64.0.0.0/2            12.0.0.0/6    
ACCEPT     all  --  64.0.0.0/2            16.0.0.0/4    
ACCEPT     all  --  64.0.0.0/2            32.0.0.0/3    
ACCEPT     all  --  64.0.0.0/2            64.0.0.0/2    
ACCEPT     all  --  64.0.0.0/2            128.0.0.0/1    
ACCEPT     all  --  128.0.0.0/1            0.0.0.0/5    
ACCEPT     all  --  128.0.0.0/1            8.0.0.0/7    
ACCEPT     all  --  128.0.0.0/1            11.0.0.0/8    
ACCEPT     all  --  128.0.0.0/1            12.0.0.0/6    
ACCEPT     all  --  128.0.0.0/1            16.0.0.0/4    
ACCEPT     all  --  128.0.0.0/1            32.0.0.0/3    
ACCEPT     all  --  128.0.0.0/1            64.0.0.0/2    
ACCEPT     all  --  128.0.0.0/1            128.0.0.0/1    
DROP     all  --  0.0.0.0/0            0.0.0.0/0    
== to even-simpler firewall ==
ACCEPT     all  --  10.0.0.1/32            10.0.0.1/32    
ACCEPT     all  --  10.0.0.1/32            10.0.0.42/32    
ACCEPT     all  --  10.0.0.42/32            10.0.0.1/32    
ACCEPT     all  --  10.0.0.42/32            10.0.0.42/32    
ACCEPT     all  --  10.0.0.1/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.42/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.1/32            10.0.0.4/32    
ACCEPT     all  --  10.0.0.42/32            10.0.0.4/32    
ACCEPT     all  --  10.0.0.1/32            0.0.0.0/5    
ACCEPT     all  --  10.0.0.1/32            8.0.0.0/7    
ACCEPT     all  --  10.0.0.1/32            11.0.0.0/8    
ACCEPT     all  --  10.0.0.1/32            12.0.0.0/6    
ACCEPT     all  --  10.0.0.1/32            16.0.0.0/4    
ACCEPT     all  --  10.0.0.1/32            32.0.0.0/3    
ACCEPT     all  --  10.0.0.1/32            64.0.0.0/2    
ACCEPT     all  --  10.0.0.1/32            128.0.0.0/1    
ACCEPT     all  --  10.0.0.42/32            0.0.0.0/5    
ACCEPT     all  --  10.0.0.42/32            8.0.0.0/7    
ACCEPT     all  --  10.0.0.42/32            11.0.0.0/8    
ACCEPT     all  --  10.0.0.42/32            12.0.0.0/6    
ACCEPT     all  --  10.0.0.42/32            16.0.0.0/4    
ACCEPT     all  --  10.0.0.42/32            32.0.0.0/3    
ACCEPT     all  --  10.0.0.42/32            64.0.0.0/2    
ACCEPT     all  --  10.0.0.42/32            128.0.0.0/1    
ACCEPT     all  --  10.0.0.3/32            10.0.0.3/32    
ACCEPT     all  --  10.0.0.3/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.3/32            10.0.0.4/32    
ACCEPT     all  --  10.0.0.2/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.1/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.42/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.3/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.4/32    
ACCEPT     all  --  10.0.0.4/32            0.0.0.0/5    
ACCEPT     all  --  10.0.0.4/32            8.0.0.0/7    
ACCEPT     all  --  10.0.0.4/32            11.0.0.0/8    
ACCEPT     all  --  10.0.0.4/32            12.0.0.0/6    
ACCEPT     all  --  10.0.0.4/32            16.0.0.0/4    
ACCEPT     all  --  10.0.0.4/32            32.0.0.0/3    
ACCEPT     all  --  10.0.0.4/32            64.0.0.0/2    
ACCEPT     all  --  10.0.0.4/32            128.0.0.0/1    
ACCEPT     all  --  0.0.0.0/5            10.0.0.1/32    
ACCEPT     all  --  8.0.0.0/7            10.0.0.1/32    
ACCEPT     all  --  11.0.0.0/8            10.0.0.1/32    
ACCEPT     all  --  12.0.0.0/6            10.0.0.1/32    
ACCEPT     all  --  16.0.0.0/4            10.0.0.1/32    
ACCEPT     all  --  32.0.0.0/3            10.0.0.1/32    
ACCEPT     all  --  64.0.0.0/2            10.0.0.1/32    
ACCEPT     all  --  128.0.0.0/1            10.0.0.1/32    
ACCEPT     all  --  0.0.0.0/5            10.0.0.42/32    
ACCEPT     all  --  8.0.0.0/7            10.0.0.42/32    
ACCEPT     all  --  11.0.0.0/8            10.0.0.42/32    
ACCEPT     all  --  12.0.0.0/6            10.0.0.42/32    
ACCEPT     all  --  16.0.0.0/4            10.0.0.42/32    
ACCEPT     all  --  32.0.0.0/3            10.0.0.42/32    
ACCEPT     all  --  64.0.0.0/2            10.0.0.42/32    
ACCEPT     all  --  128.0.0.0/1            10.0.0.42/32    
ACCEPT     all  --  0.0.0.0/5            0.0.0.0/5    
ACCEPT     all  --  0.0.0.0/5            8.0.0.0/7    
ACCEPT     all  --  0.0.0.0/5            11.0.0.0/8    
ACCEPT     all  --  0.0.0.0/5            12.0.0.0/6    
ACCEPT     all  --  0.0.0.0/5            16.0.0.0/4    
ACCEPT     all  --  0.0.0.0/5            32.0.0.0/3    
ACCEPT     all  --  0.0.0.0/5            64.0.0.0/2    
ACCEPT     all  --  0.0.0.0/5            128.0.0.0/1    
ACCEPT     all  --  8.0.0.0/7            0.0.0.0/5    
ACCEPT     all  --  8.0.0.0/7            8.0.0.0/7    
ACCEPT     all  --  8.0.0.0/7            11.0.0.0/8    
ACCEPT     all  --  8.0.0.0/7            12.0.0.0/6    
ACCEPT     all  --  8.0.0.0/7            16.0.0.0/4    
ACCEPT     all  --  8.0.0.0/7            32.0.0.0/3    
ACCEPT     all  --  8.0.0.0/7            64.0.0.0/2    
ACCEPT     all  --  8.0.0.0/7            128.0.0.0/1    
ACCEPT     all  --  11.0.0.0/8            0.0.0.0/5    
ACCEPT     all  --  11.0.0.0/8            8.0.0.0/7    
ACCEPT     all  --  11.0.0.0/8            11.0.0.0/8    
ACCEPT     all  --  11.0.0.0/8            12.0.0.0/6    
ACCEPT     all  --  11.0.0.0/8            16.0.0.0/4    
ACCEPT     all  --  11.0.0.0/8            32.0.0.0/3    
ACCEPT     all  --  11.0.0.0/8            64.0.0.0/2    
ACCEPT     all  --  11.0.0.0/8            128.0.0.0/1    
ACCEPT     all  --  12.0.0.0/6            0.0.0.0/5    
ACCEPT     all  --  12.0.0.0/6            8.0.0.0/7    
ACCEPT     all  --  12.0.0.0/6            11.0.0.0/8    
ACCEPT     all  --  12.0.0.0/6            12.0.0.0/6    
ACCEPT     all  --  12.0.0.0/6            16.0.0.0/4    
ACCEPT     all  --  12.0.0.0/6            32.0.0.0/3    
ACCEPT     all  --  12.0.0.0/6            64.0.0.0/2    
ACCEPT     all  --  12.0.0.0/6            128.0.0.0/1    
ACCEPT     all  --  16.0.0.0/4            0.0.0.0/5    
ACCEPT     all  --  16.0.0.0/4            8.0.0.0/7    
ACCEPT     all  --  16.0.0.0/4            11.0.0.0/8    
ACCEPT     all  --  16.0.0.0/4            12.0.0.0/6    
ACCEPT     all  --  16.0.0.0/4            16.0.0.0/4    
ACCEPT     all  --  16.0.0.0/4            32.0.0.0/3    
ACCEPT     all  --  16.0.0.0/4            64.0.0.0/2    
ACCEPT     all  --  16.0.0.0/4            128.0.0.0/1    
ACCEPT     all  --  32.0.0.0/3            0.0.0.0/5    
ACCEPT     all  --  32.0.0.0/3            8.0.0.0/7    
ACCEPT     all  --  32.0.0.0/3            11.0.0.0/8    
ACCEPT     all  --  32.0.0.0/3            12.0.0.0/6    
ACCEPT     all  --  32.0.0.0/3            16.0.0.0/4    
ACCEPT     all  --  32.0.0.0/3            32.0.0.0/3    
ACCEPT     all  --  32.0.0.0/3            64.0.0.0/2    
ACCEPT     all  --  32.0.0.0/3            128.0.0.0/1    
ACCEPT     all  --  64.0.0.0/2            0.0.0.0/5    
ACCEPT     all  --  64.0.0.0/2            8.0.0.0/7    
ACCEPT     all  --  64.0.0.0/2            11.0.0.0/8    
ACCEPT     all  --  64.0.0.0/2            12.0.0.0/6    
ACCEPT     all  --  64.0.0.0/2            16.0.0.0/4    
ACCEPT     all  --  64.0.0.0/2            32.0.0.0/3    
ACCEPT     all  --  64.0.0.0/2            64.0.0.0/2    
ACCEPT     all  --  64.0.0.0/2            128.0.0.0/1    
ACCEPT     all  --  128.0.0.0/1            0.0.0.0/5    
ACCEPT     all  --  128.0.0.0/1            8.0.0.0/7    
ACCEPT     all  --  128.0.0.0/1            11.0.0.0/8    
ACCEPT     all  --  128.0.0.0/1            12.0.0.0/6    
ACCEPT     all  --  128.0.0.0/1            16.0.0.0/4    
ACCEPT     all  --  128.0.0.0/1            32.0.0.0/3    
ACCEPT     all  --  128.0.0.0/1            64.0.0.0/2    
ACCEPT     all  --  128.0.0.0/1            128.0.0.0/1    
DROP     all  --  0.0.0.0/0            0.0.0.0/0    
== checking spoofing protection ==
distinct: passed
ipassmt_sanity_nowildcards: passed
ipassmt_sanity_defined (interfaces defined in the ruleset are also in ipassmt): passed
ipassmt_sanity_disjoint (no zone-spanning interfaces): passed
ipassmt_sanity_disjoint excluding UNIV interfaces: passed
ipassmt_sanity_complete: the following is not covered: {0.0.0.0 .. 9.255.255.255} u {11.0.0.0 .. 172.16.255.255} u {172.18.0.0 .. 255.255.255.255}
ipassmt_sanity_complete excluding UNIV interfaces: the following is not covered: {0.0.0.0 .. 9.255.255.255} u {11.0.0.0 .. 172.16.255.255} u {172.18.0.0 .. 255.255.255.255}
Spoofing certification results:
("docker0","Probably not (False)")
("br-b74b417b331f","True (certified)")
== calculating service matrices ==
=========== TCP port 10000->22 =========
a |-> {0.0.0.0 .. 9.255.255.255} u {11.0.0.0 .. 255.255.255.255}
b |-> 10.0.0.1 u 10.0.0.42
c |-> 10.0.0.4
d |-> 10.0.0.3
e |-> 10.0.0.2
f |-> 10.0.0.0 u {10.0.0.5 .. 10.0.0.41} u {10.0.0.43 .. 10.255.255.255}

(a,a)
(a,b)
(b,a)
(b,b)
(b,c)
(b,e)
(c,a)
(c,b)
(c,c)
(c,d)
(c,e)
(d,c)
(d,d)
(d,e)
(e,e)

=========== TCP port 10000->80 =========
a |-> {0.0.0.0 .. 9.255.255.255} u {11.0.0.0 .. 255.255.255.255}
b |-> 10.0.0.1 u 10.0.0.42
c |-> 10.0.0.4
d |-> 10.0.0.3
e |-> 10.0.0.2
f |-> 10.0.0.0 u {10.0.0.5 .. 10.0.0.41} u {10.0.0.43 .. 10.255.255.255}

(a,a)
(a,b)
(b,a)
(b,b)
(b,c)
(b,e)
(c,a)
(c,b)
(c,c)
(c,d)
(c,e)
(d,c)
(d,d)
(d,e)
(e,e)






---- story continues:
adding custom rules again, now better organized in custom chain


part1: everything established.
isabelle fffuu just gives one big matrix (one entity=everything) for established
Container connectivity too much: now almost everyone can ping Log (normally, pongs should be dropped)

# Completed on Sun Dec  4 17:47:13 2016
# Generated by iptables-save v1.6.0 on Sun Dec  4 17:47:13 2016
*filter
:INPUT ACCEPT [366:27750]
:FORWARD DROP [53:4212]
:OUTPUT ACCEPT [390:28265]
:CUSTOM - [0:0]
-A FORWARD ! -s 10.0.0.0/8 -d 10.0.0.4/32 ! -i br-b74b417b331f -o br-b74b417b331f -m state --state ESTABLISHED -j ACCEPT
-A FORWARD -j CUSTOM
-A FORWARD -s 10.0.0.1/32 -d 10.0.0.1/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.1/32 -d 10.0.0.42/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.42/32 -d 10.0.0.1/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.42/32 -d 10.0.0.42/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.1/32 -d 10.0.0.2/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.42/32 -d 10.0.0.2/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.1/32 -d 10.0.0.4/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.42/32 -d 10.0.0.4/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.1/32 -i br-b74b417b331f ! -o br-b74b417b331f -m iprange ! --dst-range 10.0.0.0-10.255.255.255 -j ACCEPT
-A FORWARD -s 10.0.0.42/32 -i br-b74b417b331f ! -o br-b74b417b331f -m iprange ! --dst-range 10.0.0.0-10.255.255.255 -j ACCEPT
-A FORWARD -s 10.0.0.3/32 -d 10.0.0.3/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.3/32 -d 10.0.0.2/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.3/32 -d 10.0.0.4/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.2/32 -d 10.0.0.2/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.4/32 -d 10.0.0.1/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.4/32 -d 10.0.0.42/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.4/32 -d 10.0.0.3/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.4/32 -d 10.0.0.2/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.4/32 -d 10.0.0.4/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.4/32 ! -d 10.0.0.0/8 -i br-b74b417b331f ! -o br-b74b417b331f -j ACCEPT
-A FORWARD -d 10.0.0.1/32 ! -i br-b74b417b331f -o br-b74b417b331f -m iprange ! --src-range 10.0.0.0-10.255.255.255 -j ACCEPT
-A FORWARD -d 10.0.0.42/32 ! -i br-b74b417b331f -o br-b74b417b331f -m iprange ! --src-range 10.0.0.0-10.255.255.255 -j ACCEPT
-A FORWARD ! -s 10.0.0.0/8 ! -d 10.0.0.0/8 ! -i br-b74b417b331f ! -o br-b74b417b331f -j ACCEPT
-A CUSTOM
-A CUSTOM -d 193.99.144.80/32 -m recent --set --name rateheise --mask 255.255.255.255 --rsource
-A CUSTOM -d 193.99.144.80/32 -m recent --update --seconds 60 --hitcount 3 --name rateheise --mask 255.255.255.255 --rsource -j DROP
-A CUSTOM -m state --state ESTABLISHED -j ACCEPT
-A CUSTOM -p tcp -m tcp --dport 22 -j ACCEPT
COMMIT
# Completed on Sun Dec  4 17:47:13 2016






--
fixing with better established rule



*filter
:INPUT ACCEPT [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]
:CUSTOM - [0:0]
-A FORWARD -j CUSTOM
-A CUSTOM 
-A CUSTOM -d 193.99.144.80/32 -m recent --set --name rateheise --mask 255.255.255.255 --rsource
-A CUSTOM -d 193.99.144.80/32 -m recent --update --seconds 60 --hitcount 3 --name rateheise --mask 255.255.255.255 --rsource -j DROP
-A CUSTOM -m state --state ESTABLISHED -p tcp -m multiport --ports 22 -j ACCEPT
-A CUSTOM -p tcp -m tcp --dport 22 -j ACCEPT
-A FORWARD -i br-b74b417b331f -s 10.0.0.1,10.0.0.42 -o br-b74b417b331f -d 10.0.0.1,10.0.0.42 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s 10.0.0.1,10.0.0.42 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s 10.0.0.1,10.0.0.42 -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s 10.0.0.1,10.0.0.42 ! -o br-b74b417b331f -m iprange ! --dst-range 10.0.0.0-10.255.255.255 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s 10.0.0.3 -o br-b74b417b331f -d 10.0.0.3 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s 10.0.0.3 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s 10.0.0.3 -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s 10.0.0.2 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.1,10.0.0.42 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.3 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s 10.0.0.4 -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT 
-A FORWARD -i br-b74b417b331f -s 10.0.0.4 ! -o br-b74b417b331f ! -d 10.0.0.0/8 -j ACCEPT
-A FORWARD ! -i br-b74b417b331f -m iprange ! --src-range 10.0.0.0-10.255.255.255 -o br-b74b417b331f -d 10.0.0.1,10.0.0.42 -j ACCEPT
-A FORWARD ! -i br-b74b417b331f ! -s 10.0.0.0/8 ! -o br-b74b417b331f ! -d 10.0.0.0/8 -j ACCEPT
-I FORWARD -m state --state ESTABLISHED ! -i br-b74b417b331f ! -s 10.0.0.0/8 -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT 
COMMIT


diff
 :INPUT ACCEPT [0:0]
 :FORWARD DROP [0:0]
 :OUTPUT ACCEPT [0:0]
+:CUSTOM - [0:0]
+-A FORWARD -j CUSTOM
+-A CUSTOM 
+-A CUSTOM -d 193.99.144.80/32 -m recent --set --name rateheise --mask 255.255.255.255 --rsource
+-A CUSTOM -d 193.99.144.80/32 -m recent --update --seconds 60 --hitcount 3 --name rateheise --mask 255.255.255.255 --rsource -j DROP
+-A CUSTOM -m state --state ESTABLISHED -p tcp -m multiport --ports 22 -j ACCEPT
+-A CUSTOM -p tcp -m tcp --dport 22 -j ACCEPT
 -A FORWARD -i br-b74b417b331f -s 10.0.0.1,10.0.0.42 -o br-b74b417b331f -d 10.0.0.1,10.0.0.42 -j ACCEPT 
 -A FORWARD -i br-b74b417b331f -s 10.0.0.1,10.0.0.42 -o br-b74b417b331f -d 10.0.0.2 -j ACCEPT 
 -A FORWARD -i br-b74b417b331f -s 10.0.0.1,10.0.0.42 -o br-b74b417b331f -d 10.0.0.4 -j ACCEPT

what the kernel loads:
# Generated by iptables-save v1.6.0 on Thu Nov 24 16:55:13 2016
*nat
:PREROUTING ACCEPT [34:2364]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [108:8104]
:POSTROUTING ACCEPT [12:900]
:DOCKER - [0:0]
-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER
-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER
-A POSTROUTING -s 10.0.0.0/8 ! -o br-b74b417b331f -j MASQUERADE
-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE
-A DOCKER -i br-b74b417b331f -j RETURN
-A DOCKER -i docker0 -j RETURN
COMMIT
# Completed on Thu Nov 24 16:55:13 2016
# Generated by iptables-save v1.6.0 on Thu Nov 24 16:55:13 2016
*filter
:INPUT ACCEPT [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]
:CUSTOM - [0:0]
-A FORWARD ! -s 10.0.0.0/8 -d 10.0.0.4/32 ! -i br-b74b417b331f -o br-b74b417b331f -m state --state ESTABLISHED -j ACCEPT
-A FORWARD -j CUSTOM
-A FORWARD -s 10.0.0.1/32 -d 10.0.0.1/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.1/32 -d 10.0.0.42/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.42/32 -d 10.0.0.1/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.42/32 -d 10.0.0.42/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.1/32 -d 10.0.0.2/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.42/32 -d 10.0.0.2/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.1/32 -d 10.0.0.4/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.42/32 -d 10.0.0.4/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.1/32 -i br-b74b417b331f ! -o br-b74b417b331f -m iprange ! --dst-range 10.0.0.0-10.255.255.255 -j ACCEPT
-A FORWARD -s 10.0.0.42/32 -i br-b74b417b331f ! -o br-b74b417b331f -m iprange ! --dst-range 10.0.0.0-10.255.255.255 -j ACCEPT
-A FORWARD -s 10.0.0.3/32 -d 10.0.0.3/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.3/32 -d 10.0.0.2/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.3/32 -d 10.0.0.4/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.2/32 -d 10.0.0.2/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.4/32 -d 10.0.0.1/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.4/32 -d 10.0.0.42/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.4/32 -d 10.0.0.3/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.4/32 -d 10.0.0.2/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.4/32 -d 10.0.0.4/32 -i br-b74b417b331f -o br-b74b417b331f -j ACCEPT
-A FORWARD -s 10.0.0.4/32 ! -d 10.0.0.0/8 -i br-b74b417b331f ! -o br-b74b417b331f -j ACCEPT
-A FORWARD -d 10.0.0.1/32 ! -i br-b74b417b331f -o br-b74b417b331f -m iprange ! --src-range 10.0.0.0-10.255.255.255 -j ACCEPT
-A FORWARD -d 10.0.0.42/32 ! -i br-b74b417b331f -o br-b74b417b331f -m iprange ! --src-range 10.0.0.0-10.255.255.255 -j ACCEPT
-A FORWARD ! -s 10.0.0.0/8 ! -d 10.0.0.0/8 ! -i br-b74b417b331f ! -o br-b74b417b331f -j ACCEPT
-A CUSTOM
-A CUSTOM -d 193.99.144.80/32 -m recent --set --name rateheise --mask 255.255.255.255 --rsource
-A CUSTOM -d 193.99.144.80/32 -m recent --update --seconds 60 --hitcount 3 --name rateheise --mask 255.255.255.255 --rsource -j DROP
-A CUSTOM -p tcp -m state --state ESTABLISHED -m multiport --ports 22 -j ACCEPT
-A CUSTOM -p tcp -m tcp --dport 22 -j ACCEPT
COMMIT
# Completed on Thu Nov 24 16:55:13 2016



checked connectivity (also ssh and rate limiting)


fffuu

$ ./dist/build/fffuu/fffuu --ipassmt ipassmt_docker dockermynet.topos4.1 
Parsed IpAssmt
IpAssmt [(docker0,Pos [172.17.0.1/16]),(br-b74b417b331f,Pos [10.0.0.0/8])]
== Checking which tables are supported for analysis. Usually, only `filter'. ==
sanity_wf_ruleset passed
Parsed 4 chains in table filter, a total of 30 rules
Table `nat' caught exception: `Reading ruleset failed! sanity_wf_ruleset check failed.'. Analysis not possible for this table. This is probably due to unsupportd actions (or a bug in the parser).
== Transformed to Isabelle type (only filter table) ==
== unfolded FORWARD chain (upper closure) ==
sanity_wf_ruleset passed
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.4/32 -s 0.0.0.0/5 -m state --state ESTABLISHED, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.4/32 -s 8.0.0.0/7 -m state --state ESTABLISHED, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.4/32 -s 11.0.0.0/8 -m state --state ESTABLISHED, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.4/32 -s 12.0.0.0/6 -m state --state ESTABLISHED, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.4/32 -s 16.0.0.0/4 -m state --state ESTABLISHED, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.4/32 -s 32.0.0.0/3 -m state --state ESTABLISHED, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.4/32 -s 64.0.0.0/2 -m state --state ESTABLISHED, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.4/32 -s 128.0.0.0/1 -m state --state ESTABLISHED, -j ACCEPT)
(-p tcp -m tcp --spts [22] -m state --state ESTABLISHED, -j ACCEPT)
(-p tcp -m tcp --dpts [22] -m state --state ESTABLISHED, -j ACCEPT)
(-p tcp -m tcp --dpts [22], -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.1/32 -s 10.0.0.1/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.42/32 -s 10.0.0.1/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.1/32 -s 10.0.0.42/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.42/32 -s 10.0.0.42/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.1/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.42/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.4/32 -s 10.0.0.1/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.4/32 -s 10.0.0.42/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 0.0.0.0/5 -s 10.0.0.1/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 8.0.0.0/7 -s 10.0.0.1/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 11.0.0.0/8 -s 10.0.0.1/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 12.0.0.0/6 -s 10.0.0.1/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 16.0.0.0/4 -s 10.0.0.1/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 32.0.0.0/3 -s 10.0.0.1/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 64.0.0.0/2 -s 10.0.0.1/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 128.0.0.0/1 -s 10.0.0.1/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 0.0.0.0/5 -s 10.0.0.42/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 8.0.0.0/7 -s 10.0.0.42/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 11.0.0.0/8 -s 10.0.0.42/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 12.0.0.0/6 -s 10.0.0.42/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 16.0.0.0/4 -s 10.0.0.42/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 32.0.0.0/3 -s 10.0.0.42/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 64.0.0.0/2 -s 10.0.0.42/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 128.0.0.0/1 -s 10.0.0.42/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.3/32 -s 10.0.0.3/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.3/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.4/32 -s 10.0.0.3/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.2/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.1/32 -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.42/32 -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.3/32 -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.2/32 -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f -i br-b74b417b331f -d 10.0.0.4/32 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 0.0.0.0/5 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 8.0.0.0/7 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 11.0.0.0/8 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 12.0.0.0/6 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 16.0.0.0/4 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 32.0.0.0/3 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 64.0.0.0/2 -s 10.0.0.4/32, -j ACCEPT)
(! -o br-b74b417b331f -i br-b74b417b331f -d 128.0.0.0/1 -s 10.0.0.4/32, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 0.0.0.0/5, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 8.0.0.0/7, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 11.0.0.0/8, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 12.0.0.0/6, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 16.0.0.0/4, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 32.0.0.0/3, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 64.0.0.0/2, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.1/32 -s 128.0.0.0/1, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.42/32 -s 0.0.0.0/5, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.42/32 -s 8.0.0.0/7, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.42/32 -s 11.0.0.0/8, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.42/32 -s 12.0.0.0/6, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.42/32 -s 16.0.0.0/4, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.42/32 -s 32.0.0.0/3, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.42/32 -s 64.0.0.0/2, -j ACCEPT)
(-o br-b74b417b331f ! -i br-b74b417b331f -d 10.0.0.42/32 -s 128.0.0.0/1, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 0.0.0.0/5 -s 0.0.0.0/5, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 8.0.0.0/7 -s 0.0.0.0/5, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 11.0.0.0/8 -s 0.0.0.0/5, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 12.0.0.0/6 -s 0.0.0.0/5, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 16.0.0.0/4 -s 0.0.0.0/5, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 32.0.0.0/3 -s 0.0.0.0/5, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 64.0.0.0/2 -s 0.0.0.0/5, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 128.0.0.0/1 -s 0.0.0.0/5, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 0.0.0.0/5 -s 8.0.0.0/7, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 8.0.0.0/7 -s 8.0.0.0/7, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 11.0.0.0/8 -s 8.0.0.0/7, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 12.0.0.0/6 -s 8.0.0.0/7, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 16.0.0.0/4 -s 8.0.0.0/7, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 32.0.0.0/3 -s 8.0.0.0/7, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 64.0.0.0/2 -s 8.0.0.0/7, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 128.0.0.0/1 -s 8.0.0.0/7, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 0.0.0.0/5 -s 11.0.0.0/8, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 8.0.0.0/7 -s 11.0.0.0/8, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 11.0.0.0/8 -s 11.0.0.0/8, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 12.0.0.0/6 -s 11.0.0.0/8, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 16.0.0.0/4 -s 11.0.0.0/8, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 32.0.0.0/3 -s 11.0.0.0/8, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 64.0.0.0/2 -s 11.0.0.0/8, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 128.0.0.0/1 -s 11.0.0.0/8, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 0.0.0.0/5 -s 12.0.0.0/6, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 8.0.0.0/7 -s 12.0.0.0/6, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 11.0.0.0/8 -s 12.0.0.0/6, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 12.0.0.0/6 -s 12.0.0.0/6, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 16.0.0.0/4 -s 12.0.0.0/6, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 32.0.0.0/3 -s 12.0.0.0/6, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 64.0.0.0/2 -s 12.0.0.0/6, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 128.0.0.0/1 -s 12.0.0.0/6, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 0.0.0.0/5 -s 16.0.0.0/4, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 8.0.0.0/7 -s 16.0.0.0/4, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 11.0.0.0/8 -s 16.0.0.0/4, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 12.0.0.0/6 -s 16.0.0.0/4, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 16.0.0.0/4 -s 16.0.0.0/4, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 32.0.0.0/3 -s 16.0.0.0/4, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 64.0.0.0/2 -s 16.0.0.0/4, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 128.0.0.0/1 -s 16.0.0.0/4, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 0.0.0.0/5 -s 32.0.0.0/3, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 8.0.0.0/7 -s 32.0.0.0/3, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 11.0.0.0/8 -s 32.0.0.0/3, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 12.0.0.0/6 -s 32.0.0.0/3, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 16.0.0.0/4 -s 32.0.0.0/3, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 32.0.0.0/3 -s 32.0.0.0/3, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 64.0.0.0/2 -s 32.0.0.0/3, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 128.0.0.0/1 -s 32.0.0.0/3, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 0.0.0.0/5 -s 64.0.0.0/2, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 8.0.0.0/7 -s 64.0.0.0/2, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 11.0.0.0/8 -s 64.0.0.0/2, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 12.0.0.0/6 -s 64.0.0.0/2, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 16.0.0.0/4 -s 64.0.0.0/2, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 32.0.0.0/3 -s 64.0.0.0/2, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 64.0.0.0/2 -s 64.0.0.0/2, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 128.0.0.0/1 -s 64.0.0.0/2, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 0.0.0.0/5 -s 128.0.0.0/1, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 8.0.0.0/7 -s 128.0.0.0/1, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 11.0.0.0/8 -s 128.0.0.0/1, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 12.0.0.0/6 -s 128.0.0.0/1, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 16.0.0.0/4 -s 128.0.0.0/1, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 32.0.0.0/3 -s 128.0.0.0/1, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 64.0.0.0/2 -s 128.0.0.0/1, -j ACCEPT)
(! -o br-b74b417b331f ! -i br-b74b417b331f -d 128.0.0.0/1 -s 128.0.0.0/1, -j ACCEPT)
(, -j DROP)
== to simple firewall ==
ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0    dports: 22
ACCEPT     all  --  10.0.0.1/32            10.0.0.1/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.1/32            10.0.0.42/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.42/32            10.0.0.1/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.42/32            10.0.0.42/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.1/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.42/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.1/32            10.0.0.4/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.42/32            10.0.0.4/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.1/32            0.0.0.0/5 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.1/32            8.0.0.0/7 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.1/32            11.0.0.0/8 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.1/32            12.0.0.0/6 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.1/32            16.0.0.0/4 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.1/32            32.0.0.0/3 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.1/32            64.0.0.0/2 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.1/32            128.0.0.0/1 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.42/32            0.0.0.0/5 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.42/32            8.0.0.0/7 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.42/32            11.0.0.0/8 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.42/32            12.0.0.0/6 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.42/32            16.0.0.0/4 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.42/32            32.0.0.0/3 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.42/32            64.0.0.0/2 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.42/32            128.0.0.0/1 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.3/32            10.0.0.3/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.3/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.3/32            10.0.0.4/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.2/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.1/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.42/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.3/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.2/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            10.0.0.4/32 in: br-b74b417b331f out: br-b74b417b331f  
ACCEPT     all  --  10.0.0.4/32            0.0.0.0/5 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            8.0.0.0/7 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            11.0.0.0/8 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            12.0.0.0/6 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            16.0.0.0/4 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            32.0.0.0/3 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            64.0.0.0/2 in: br-b74b417b331f   
ACCEPT     all  --  10.0.0.4/32            128.0.0.0/1 in: br-b74b417b331f   
ACCEPT     all  --  0.0.0.0/5            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  8.0.0.0/7            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  11.0.0.0/8            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  12.0.0.0/6            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  16.0.0.0/4            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  32.0.0.0/3            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  64.0.0.0/2            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  128.0.0.0/1            10.0.0.1/32  out: br-b74b417b331f  
ACCEPT     all  --  0.0.0.0/5            10.0.0.42/32  out: br-b74b417b331f  
ACCEPT     all  --  8.0.0.0/7            10.0.0.42/32  out: br-b74b417b331f  
ACCEPT     all  --  11.0.0.0/8            10.0.0.42/32  out: br-b74b417b331f  
ACCEPT     all  --  12.0.0.0/6            10.0.0.42/32  out: br-b74b417b331f  
ACCEPT     all  --  16.0.0.0/4            10.0.0.42/32  out: br-b74b417b331f  
ACCEPT     all  --  32.0.0.0/3            10.0.0.42/32  out: br-b74b417b331f  
ACCEPT     all  --  64.0.0.0/2            10.0.0.42/32  out: br-b74b417b331f  
ACCEPT     all  --  128.0.0.0/1            10.0.0.42/32  out: br-b74b417b331f  
ACCEPT     all  --  0.0.0.0/5            0.0.0.0/5    
ACCEPT     all  --  0.0.0.0/5            8.0.0.0/7    
ACCEPT     all  --  0.0.0.0/5            11.0.0.0/8    
ACCEPT     all  --  0.0.0.0/5            12.0.0.0/6    
ACCEPT     all  --  0.0.0.0/5            16.0.0.0/4    
ACCEPT     all  --  0.0.0.0/5            32.0.0.0/3    
ACCEPT     all  --  0.0.0.0/5            64.0.0.0/2    
ACCEPT     all  --  0.0.0.0/5            128.0.0.0/1    
ACCEPT     all  --  8.0.0.0/7            0.0.0.0/5    
ACCEPT     all  --  8.0.0.0/7            8.0.0.0/7    
ACCEPT     all  --  8.0.0.0/7            11.0.0.0/8    
ACCEPT     all  --  8.0.0.0/7            12.0.0.0/6    
ACCEPT     all  --  8.0.0.0/7            16.0.0.0/4    
ACCEPT     all  --  8.0.0.0/7            32.0.0.0/3    
ACCEPT     all  --  8.0.0.0/7            64.0.0.0/2    
ACCEPT     all  --  8.0.0.0/7            128.0.0.0/1    
ACCEPT     all  --  11.0.0.0/8            0.0.0.0/5    
ACCEPT     all  --  11.0.0.0/8            8.0.0.0/7    
ACCEPT     all  --  11.0.0.0/8            11.0.0.0/8    
ACCEPT     all  --  11.0.0.0/8            12.0.0.0/6    
ACCEPT     all  --  11.0.0.0/8            16.0.0.0/4    
ACCEPT     all  --  11.0.0.0/8            32.0.0.0/3    
ACCEPT     all  --  11.0.0.0/8            64.0.0.0/2    
ACCEPT     all  --  11.0.0.0/8            128.0.0.0/1    
ACCEPT     all  --  12.0.0.0/6            0.0.0.0/5    
ACCEPT     all  --  12.0.0.0/6            8.0.0.0/7    
ACCEPT     all  --  12.0.0.0/6            11.0.0.0/8    
ACCEPT     all  --  12.0.0.0/6            12.0.0.0/6    
ACCEPT     all  --  12.0.0.0/6            16.0.0.0/4    
ACCEPT     all  --  12.0.0.0/6            32.0.0.0/3    
ACCEPT     all  --  12.0.0.0/6            64.0.0.0/2    
ACCEPT     all  --  12.0.0.0/6            128.0.0.0/1    
ACCEPT     all  --  16.0.0.0/4            0.0.0.0/5    
ACCEPT     all  --  16.0.0.0/4            8.0.0.0/7    
ACCEPT     all  --  16.0.0.0/4            11.0.0.0/8    
ACCEPT     all  --  16.0.0.0/4            12.0.0.0/6    
ACCEPT     all  --  16.0.0.0/4            16.0.0.0/4    
ACCEPT     all  --  16.0.0.0/4            32.0.0.0/3    
ACCEPT     all  --  16.0.0.0/4            64.0.0.0/2    
ACCEPT     all  --  16.0.0.0/4            128.0.0.0/1    
ACCEPT     all  --  32.0.0.0/3            0.0.0.0/5    
ACCEPT     all  --  32.0.0.0/3            8.0.0.0/7    
ACCEPT     all  --  32.0.0.0/3            11.0.0.0/8    
ACCEPT     all  --  32.0.0.0/3            12.0.0.0/6    
ACCEPT     all  --  32.0.0.0/3            16.0.0.0/4    
ACCEPT     all  --  32.0.0.0/3            32.0.0.0/3    
ACCEPT     all  --  32.0.0.0/3            64.0.0.0/2    
ACCEPT     all  --  32.0.0.0/3            128.0.0.0/1    
ACCEPT     all  --  64.0.0.0/2            0.0.0.0/5    
ACCEPT     all  --  64.0.0.0/2            8.0.0.0/7    
ACCEPT     all  --  64.0.0.0/2            11.0.0.0/8    
ACCEPT     all  --  64.0.0.0/2            12.0.0.0/6    
ACCEPT     all  --  64.0.0.0/2            16.0.0.0/4    
ACCEPT     all  --  64.0.0.0/2            32.0.0.0/3    
ACCEPT     all  --  64.0.0.0/2            64.0.0.0/2    
ACCEPT     all  --  64.0.0.0/2            128.0.0.0/1    
ACCEPT     all  --  128.0.0.0/1            0.0.0.0/5    
ACCEPT     all  --  128.0.0.0/1            8.0.0.0/7    
ACCEPT     all  --  128.0.0.0/1            11.0.0.0/8    
ACCEPT     all  --  128.0.0.0/1            12.0.0.0/6    
ACCEPT     all  --  128.0.0.0/1            16.0.0.0/4    
ACCEPT     all  --  128.0.0.0/1            32.0.0.0/3    
ACCEPT     all  --  128.0.0.0/1            64.0.0.0/2    
ACCEPT     all  --  128.0.0.0/1            128.0.0.0/1    
DROP     all  --  0.0.0.0/0            0.0.0.0/0    
== to even-simpler firewall ==
ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0    dports: 22
ACCEPT     all  --  10.0.0.1/32            10.0.0.1/32    
ACCEPT     all  --  10.0.0.1/32            10.0.0.42/32    
ACCEPT     all  --  10.0.0.42/32            10.0.0.1/32    
ACCEPT     all  --  10.0.0.42/32            10.0.0.42/32    
ACCEPT     all  --  10.0.0.1/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.42/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.1/32            10.0.0.4/32    
ACCEPT     all  --  10.0.0.42/32            10.0.0.4/32    
ACCEPT     all  --  10.0.0.1/32            0.0.0.0/5    
ACCEPT     all  --  10.0.0.1/32            8.0.0.0/7    
ACCEPT     all  --  10.0.0.1/32            11.0.0.0/8    
ACCEPT     all  --  10.0.0.1/32            12.0.0.0/6    
ACCEPT     all  --  10.0.0.1/32            16.0.0.0/4    
ACCEPT     all  --  10.0.0.1/32            32.0.0.0/3    
ACCEPT     all  --  10.0.0.1/32            64.0.0.0/2    
ACCEPT     all  --  10.0.0.1/32            128.0.0.0/1    
ACCEPT     all  --  10.0.0.42/32            0.0.0.0/5    
ACCEPT     all  --  10.0.0.42/32            8.0.0.0/7    
ACCEPT     all  --  10.0.0.42/32            11.0.0.0/8    
ACCEPT     all  --  10.0.0.42/32            12.0.0.0/6    
ACCEPT     all  --  10.0.0.42/32            16.0.0.0/4    
ACCEPT     all  --  10.0.0.42/32            32.0.0.0/3    
ACCEPT     all  --  10.0.0.42/32            64.0.0.0/2    
ACCEPT     all  --  10.0.0.42/32            128.0.0.0/1    
ACCEPT     all  --  10.0.0.3/32            10.0.0.3/32    
ACCEPT     all  --  10.0.0.3/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.3/32            10.0.0.4/32    
ACCEPT     all  --  10.0.0.2/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.1/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.42/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.3/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.2/32    
ACCEPT     all  --  10.0.0.4/32            10.0.0.4/32    
ACCEPT     all  --  10.0.0.4/32            0.0.0.0/5    
ACCEPT     all  --  10.0.0.4/32            8.0.0.0/7    
ACCEPT     all  --  10.0.0.4/32            11.0.0.0/8    
ACCEPT     all  --  10.0.0.4/32            12.0.0.0/6    
ACCEPT     all  --  10.0.0.4/32            16.0.0.0/4    
ACCEPT     all  --  10.0.0.4/32            32.0.0.0/3    
ACCEPT     all  --  10.0.0.4/32            64.0.0.0/2    
ACCEPT     all  --  10.0.0.4/32            128.0.0.0/1    
ACCEPT     all  --  0.0.0.0/5            10.0.0.1/32    
ACCEPT     all  --  8.0.0.0/7            10.0.0.1/32    
ACCEPT     all  --  11.0.0.0/8            10.0.0.1/32    
ACCEPT     all  --  12.0.0.0/6            10.0.0.1/32    
ACCEPT     all  --  16.0.0.0/4            10.0.0.1/32    
ACCEPT     all  --  32.0.0.0/3            10.0.0.1/32    
ACCEPT     all  --  64.0.0.0/2            10.0.0.1/32    
ACCEPT     all  --  128.0.0.0/1            10.0.0.1/32    
ACCEPT     all  --  0.0.0.0/5            10.0.0.42/32    
ACCEPT     all  --  8.0.0.0/7            10.0.0.42/32    
ACCEPT     all  --  11.0.0.0/8            10.0.0.42/32    
ACCEPT     all  --  12.0.0.0/6            10.0.0.42/32    
ACCEPT     all  --  16.0.0.0/4            10.0.0.42/32    
ACCEPT     all  --  32.0.0.0/3            10.0.0.42/32    
ACCEPT     all  --  64.0.0.0/2            10.0.0.42/32    
ACCEPT     all  --  128.0.0.0/1            10.0.0.42/32    
ACCEPT     all  --  0.0.0.0/5            0.0.0.0/5    
ACCEPT     all  --  0.0.0.0/5            8.0.0.0/7    
ACCEPT     all  --  0.0.0.0/5            11.0.0.0/8    
ACCEPT     all  --  0.0.0.0/5            12.0.0.0/6    
ACCEPT     all  --  0.0.0.0/5            16.0.0.0/4    
ACCEPT     all  --  0.0.0.0/5            32.0.0.0/3    
ACCEPT     all  --  0.0.0.0/5            64.0.0.0/2    
ACCEPT     all  --  0.0.0.0/5            128.0.0.0/1    
ACCEPT     all  --  8.0.0.0/7            0.0.0.0/5    
ACCEPT     all  --  8.0.0.0/7            8.0.0.0/7    
ACCEPT     all  --  8.0.0.0/7            11.0.0.0/8    
ACCEPT     all  --  8.0.0.0/7            12.0.0.0/6    
ACCEPT     all  --  8.0.0.0/7            16.0.0.0/4    
ACCEPT     all  --  8.0.0.0/7            32.0.0.0/3    
ACCEPT     all  --  8.0.0.0/7            64.0.0.0/2    
ACCEPT     all  --  8.0.0.0/7            128.0.0.0/1    
ACCEPT     all  --  11.0.0.0/8            0.0.0.0/5    
ACCEPT     all  --  11.0.0.0/8            8.0.0.0/7    
ACCEPT     all  --  11.0.0.0/8            11.0.0.0/8    
ACCEPT     all  --  11.0.0.0/8            12.0.0.0/6    
ACCEPT     all  --  11.0.0.0/8            16.0.0.0/4    
ACCEPT     all  --  11.0.0.0/8            32.0.0.0/3    
ACCEPT     all  --  11.0.0.0/8            64.0.0.0/2    
ACCEPT     all  --  11.0.0.0/8            128.0.0.0/1    
ACCEPT     all  --  12.0.0.0/6            0.0.0.0/5    
ACCEPT     all  --  12.0.0.0/6            8.0.0.0/7    
ACCEPT     all  --  12.0.0.0/6            11.0.0.0/8    
ACCEPT     all  --  12.0.0.0/6            12.0.0.0/6    
ACCEPT     all  --  12.0.0.0/6            16.0.0.0/4    
ACCEPT     all  --  12.0.0.0/6            32.0.0.0/3    
ACCEPT     all  --  12.0.0.0/6            64.0.0.0/2    
ACCEPT     all  --  12.0.0.0/6            128.0.0.0/1    
ACCEPT     all  --  16.0.0.0/4            0.0.0.0/5    
ACCEPT     all  --  16.0.0.0/4            8.0.0.0/7    
ACCEPT     all  --  16.0.0.0/4            11.0.0.0/8    
ACCEPT     all  --  16.0.0.0/4            12.0.0.0/6    
ACCEPT     all  --  16.0.0.0/4            16.0.0.0/4    
ACCEPT     all  --  16.0.0.0/4            32.0.0.0/3    
ACCEPT     all  --  16.0.0.0/4            64.0.0.0/2    
ACCEPT     all  --  16.0.0.0/4            128.0.0.0/1    
ACCEPT     all  --  32.0.0.0/3            0.0.0.0/5    
ACCEPT     all  --  32.0.0.0/3            8.0.0.0/7    
ACCEPT     all  --  32.0.0.0/3            11.0.0.0/8    
ACCEPT     all  --  32.0.0.0/3            12.0.0.0/6    
ACCEPT     all  --  32.0.0.0/3            16.0.0.0/4    
ACCEPT     all  --  32.0.0.0/3            32.0.0.0/3    
ACCEPT     all  --  32.0.0.0/3            64.0.0.0/2    
ACCEPT     all  --  32.0.0.0/3            128.0.0.0/1    
ACCEPT     all  --  64.0.0.0/2            0.0.0.0/5    
ACCEPT     all  --  64.0.0.0/2            8.0.0.0/7    
ACCEPT     all  --  64.0.0.0/2            11.0.0.0/8    
ACCEPT     all  --  64.0.0.0/2            12.0.0.0/6    
ACCEPT     all  --  64.0.0.0/2            16.0.0.0/4    
ACCEPT     all  --  64.0.0.0/2            32.0.0.0/3    
ACCEPT     all  --  64.0.0.0/2            64.0.0.0/2    
ACCEPT     all  --  64.0.0.0/2            128.0.0.0/1    
ACCEPT     all  --  128.0.0.0/1            0.0.0.0/5    
ACCEPT     all  --  128.0.0.0/1            8.0.0.0/7    
ACCEPT     all  --  128.0.0.0/1            11.0.0.0/8    
ACCEPT     all  --  128.0.0.0/1            12.0.0.0/6    
ACCEPT     all  --  128.0.0.0/1            16.0.0.0/4    
ACCEPT     all  --  128.0.0.0/1            32.0.0.0/3    
ACCEPT     all  --  128.0.0.0/1            64.0.0.0/2    
ACCEPT     all  --  128.0.0.0/1            128.0.0.0/1    
DROP     all  --  0.0.0.0/0            0.0.0.0/0    
== checking spoofing protection ==
distinct: passed
ipassmt_sanity_nowildcards: passed
ipassmt_sanity_defined (interfaces defined in the ruleset are also in ipassmt): passed
ipassmt_sanity_disjoint (no zone-spanning interfaces): passed
ipassmt_sanity_disjoint excluding UNIV interfaces: passed
ipassmt_sanity_complete: the following is not covered: {0.0.0.0 .. 9.255.255.255} u {11.0.0.0 .. 172.16.255.255} u {172.18.0.0 .. 255.255.255.255}
ipassmt_sanity_complete excluding UNIV interfaces: the following is not covered: {0.0.0.0 .. 9.255.255.255} u {11.0.0.0 .. 172.16.255.255} u {172.18.0.0 .. 255.255.255.255}
Spoofing certification results:
("docker0","Probably not (False)")
("br-b74b417b331f","Probably not (False)")
== calculating service matrices ==
=========== TCP port 10000->22 =========
a |-> {0.0.0.0 .. 255.255.255.255}

(a,a)

=========== TCP port 10000->80 =========
a |-> {0.0.0.0 .. 9.255.255.255} u {11.0.0.0 .. 255.255.255.255}
b |-> 10.0.0.1 u 10.0.0.42
c |-> 10.0.0.4
d |-> 10.0.0.3
e |-> 10.0.0.2
f |-> 10.0.0.0 u {10.0.0.5 .. 10.0.0.41} u {10.0.0.43 .. 10.255.255.255}

(a,a)
(a,b)
(b,a)
(b,b)
(b,c)
(b,e)
(c,a)
(c,b)
(c,c)
(c,d)
(c,e)
(d,c)
(d,d)
(d,e)
(e,e)


see how nicely fffuu aggregated the two webfrontends!
we can also see that we did not make an error, except for ssh!!


okay, non isabelle output which also includes established. Everything as expected.


value[code] "access_matrix_pretty_ipv4 parts_connection_http 
    (preprocess unfold_ruleset_FORWARD upper_closure ipassmt docker_fw2_FORWARD_default_policy docker_fw2)"
    
"([(''0.0.0.0'',
    ''{0.0.0.0 .. 9.255.255.255} u {11.0.0.0 .. 255.255.255.255}''),
   (''10.0.0.1'', ''10.0.0.1 u 10.0.0.42''),
   (''10.0.0.4'', ''10.0.0.4''),
   (''10.0.0.3'', ''10.0.0.3''),
   (''10.0.0.2'', ''10.0.0.2''),
   (''10.0.0.0'',
    ''10.0.0.0 u {10.0.0.5 .. 10.0.0.41} u {10.0.0.43 .. 10.255.255.255}'')],
  [(''0.0.0.0'', ''0.0.0.0''),
   (''0.0.0.0'', ''10.0.0.1''),
   (''10.0.0.1'', ''0.0.0.0''),
   (''10.0.0.1'', ''10.0.0.1''),
   (''10.0.0.1'', ''10.0.0.4''),
   (''10.0.0.1'', ''10.0.0.2''),
   (''10.0.0.4'', ''0.0.0.0''),
   (''10.0.0.4'', ''10.0.0.1''),
   (''10.0.0.4'', ''10.0.0.4''),
   (''10.0.0.4'', ''10.0.0.3''),
   (''10.0.0.4'', ''10.0.0.2''),
   (''10.0.0.3'', ''10.0.0.4''),
   (''10.0.0.3'', ''10.0.0.3''),
   (''10.0.0.3'', ''10.0.0.2''),
   (''10.0.0.2'', ''10.0.0.2'')])"
  ::
  "(char list × char list) list ×
   (char list × char list) list"

---


value[code] "access_matrix_pretty_ipv4 parts_connection_http 
    (preprocess_ESTABLISHED unfold_ruleset_FORWARD upper_closure ipassmt docker_fw2_FORWARD_default_policy docker_fw2)"
    
"([(''0.0.0.0'',
    ''{0.0.0.0 .. 9.255.255.255} u {11.0.0.0 .. 255.255.255.255}''),
   (''10.0.0.1'', ''10.0.0.1 u 10.0.0.42''),
   (''10.0.0.4'', ''10.0.0.4''),
   (''10.0.0.3'', ''10.0.0.3''),
   (''10.0.0.2'', ''10.0.0.2''),
   (''10.0.0.0'',
    ''10.0.0.0 u {10.0.0.5 .. 10.0.0.41} u {10.0.0.43 .. 10.255.255.255}'')],
  [(''0.0.0.0'', ''0.0.0.0''),
   (''0.0.0.0'', ''10.0.0.1''),
   (''0.0.0.0'', ''10.0.0.4''),
   (''10.0.0.1'', ''0.0.0.0''),
   (''10.0.0.1'', ''10.0.0.1''),
   (''10.0.0.1'', ''10.0.0.4''),
   (''10.0.0.1'', ''10.0.0.2''),
   (''10.0.0.4'', ''0.0.0.0''),
   (''10.0.0.4'', ''10.0.0.1''),
   (''10.0.0.4'', ''10.0.0.4''),
   (''10.0.0.4'', ''10.0.0.3''),
   (''10.0.0.4'', ''10.0.0.2''),
   (''10.0.0.3'', ''10.0.0.4''),
   (''10.0.0.3'', ''10.0.0.3''),
   (''10.0.0.3'', ''10.0.0.2''),
   (''10.0.0.2'', ''10.0.0.2'')])"
  ::
  "(char list × char list) list ×
   (char list × char list) list"


Only difference: (''0.0.0.0'', ''10.0.0.4'') which means: INET -> WebApp may be stateful, as desired!!







=== One final connectivity check. ===
The rules docker is loading by default:
# Generated by iptables-save v1.6.0 on Wed May  3 14:40:49 2017
*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [146:9341]
:POSTROUTING ACCEPT [43:2699]
:DOCKER - [0:0]
-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER
-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER
-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE
-A POSTROUTING -s 10.0.0.0/8 ! -o br-0a5ad9e85c71 -j MASQUERADE
-A DOCKER -i docker0 -j RETURN
-A DOCKER -i br-0a5ad9e85c71 -j RETURN
COMMIT
# Completed on Wed May  3 14:40:49 2017
# Generated by iptables-save v1.6.0 on Wed May  3 14:40:49 2017
*filter
:INPUT ACCEPT [878:3516798]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [859:77933]
:DOCKER - [0:0]
:DOCKER-ISOLATION - [0:0]
-A FORWARD -j DOCKER-ISOLATION
-A FORWARD -o docker0 -j DOCKER
-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i docker0 ! -o docker0 -j ACCEPT
-A FORWARD -i docker0 -o docker0 -j ACCEPT
-A FORWARD -o br-0a5ad9e85c71 -j DOCKER
-A FORWARD -o br-0a5ad9e85c71 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i br-0a5ad9e85c71 ! -o br-0a5ad9e85c71 -j ACCEPT
-A FORWARD -i br-0a5ad9e85c71 -o br-0a5ad9e85c71 -j DROP
-A DOCKER-ISOLATION -i br-0a5ad9e85c71 -o docker0 -j DROP
-A DOCKER-ISOLATION -i docker0 -o br-0a5ad9e85c71 -j DROP
-A DOCKER-ISOLATION -j RETURN
COMMIT
# Completed on Wed May  3 14:40:49 2017

unfortunately, my bridge interface is now br-0a5ad9e85c71

The rules we are installing (the same as previously, just the bridge is renamed and the docker nat table is shown):
# Generated by iptables-save v1.6.0 on Wed May  3 14:39:08 2017
*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [146:9341]
:POSTROUTING ACCEPT [43:2699]
:DOCKER - [0:0]
-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER
-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER
-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE
-A POSTROUTING -s 10.0.0.0/8 ! -o br-0a5ad9e85c71 -j MASQUERADE
-A DOCKER -i docker0 -j RETURN
-A DOCKER -i br-0a5ad9e85c71 -j RETURN
COMMIT
# ...
*filter
:INPUT ACCEPT [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]
:CUSTOM - [0:0]
-A FORWARD -j CUSTOM
-A CUSTOM 
-A CUSTOM -d 193.99.144.80/32 -m recent --set --name rateheise --mask 255.255.255.255 --rsource
-A CUSTOM -d 193.99.144.80/32 -m recent --update --seconds 60 --hitcount 3 --name rateheise --mask 255.255.255.255 --rsource -j DROP
-A CUSTOM -m state --state ESTABLISHED -p tcp -m multiport --ports 22 -j ACCEPT
-A CUSTOM -p tcp -m tcp --dport 22 -j ACCEPT
-A FORWARD -i br-0a5ad9e85c71 -s 10.0.0.1,10.0.0.42 -o br-0a5ad9e85c71 -d 10.0.0.1,10.0.0.42 -j ACCEPT 
-A FORWARD -i br-0a5ad9e85c71 -s 10.0.0.1,10.0.0.42 -o br-0a5ad9e85c71 -d 10.0.0.2 -j ACCEPT 
-A FORWARD -i br-0a5ad9e85c71 -s 10.0.0.1,10.0.0.42 -o br-0a5ad9e85c71 -d 10.0.0.4 -j ACCEPT 
-A FORWARD -i br-0a5ad9e85c71 -s 10.0.0.1,10.0.0.42 ! -o br-0a5ad9e85c71 -m iprange ! --dst-range 10.0.0.0-10.255.255.255 -j ACCEPT 
-A FORWARD -i br-0a5ad9e85c71 -s 10.0.0.3 -o br-0a5ad9e85c71 -d 10.0.0.3 -j ACCEPT 
-A FORWARD -i br-0a5ad9e85c71 -s 10.0.0.3 -o br-0a5ad9e85c71 -d 10.0.0.2 -j ACCEPT 
-A FORWARD -i br-0a5ad9e85c71 -s 10.0.0.3 -o br-0a5ad9e85c71 -d 10.0.0.4 -j ACCEPT 
-A FORWARD -i br-0a5ad9e85c71 -s 10.0.0.2 -o br-0a5ad9e85c71 -d 10.0.0.2 -j ACCEPT 
-A FORWARD -i br-0a5ad9e85c71 -s 10.0.0.4 -o br-0a5ad9e85c71 -d 10.0.0.1,10.0.0.42 -j ACCEPT 
-A FORWARD -i br-0a5ad9e85c71 -s 10.0.0.4 -o br-0a5ad9e85c71 -d 10.0.0.3 -j ACCEPT 
-A FORWARD -i br-0a5ad9e85c71 -s 10.0.0.4 -o br-0a5ad9e85c71 -d 10.0.0.2 -j ACCEPT 
-A FORWARD -i br-0a5ad9e85c71 -s 10.0.0.4 -o br-0a5ad9e85c71 -d 10.0.0.4 -j ACCEPT 
-A FORWARD -i br-0a5ad9e85c71 -s 10.0.0.4 ! -o br-0a5ad9e85c71 ! -d 10.0.0.0/8 -j ACCEPT
-A FORWARD ! -i br-0a5ad9e85c71 -m iprange ! --src-range 10.0.0.0-10.255.255.255 -o br-0a5ad9e85c71 -d 10.0.0.1,10.0.0.42 -j ACCEPT
-A FORWARD ! -i br-0a5ad9e85c71 ! -s 10.0.0.0/8 ! -o br-0a5ad9e85c71 ! -d 10.0.0.0/8 -j ACCEPT
-I FORWARD -m state --state ESTABLISHED ! -i br-0a5ad9e85c71 ! -s 10.0.0.0/8 -o br-0a5ad9e85c71 -d 10.0.0.4 -j ACCEPT 
COMMIT

Checked connectivity:
Inter-container connectivity: Exactly as expected.
Tested in the busybox images with ping. One-way communication with log also works. Tested with ping, tcpdumping the docker bridge, we see echo replies generated by log, but they never arrive anywhere.

Note: The docker host can access all containers. This is because setting up connections to the containers does not go via the FORWARD chain but uses the INPUT/OUTPUT chains. There are no restrictions currently (but the docker host can manage the containers anyway).

An arbitrary container, spawned with ip 172.17.0.2 and not in mynet to simulate the Internet has only the desired access rights (i.e. only to webfrnt)

Test external reachability (by exposing docker ports publicly):
Set up VirtualBox (where my docker runs) to host-only networking, so we can connect from external.
#add dummy chain t filter table, never called, just to make docker happy
iptables -N DOCKER

#spawn containers with ports 6666 and 6667 exposed. Expected: 6666 reachable, 6667 not.
sudo docker run --rm -ti -p 0.0.0.0:6666:6666 --name webfrnt42 --hostname webfrnt42 --net mynet --ip 10.0.0.42 busybox
sudo docker run --rm -ti -p 0.0.0.0:6667:6667 --name webapp --hostname webapp --net mynet --ip 10.0.0.4 busybox

docker automatically adds to nat table (which I let docker manage):
-A DOCKER ! -i br-0a5ad9e85c71 -p tcp -m tcp --dport 6666 -j DNAT --to-destination 10.0.0.42:6666
-A DOCKER ! -i br-0a5ad9e85c71 -p tcp -m tcp --dport 6667 -j DNAT --to-destination 10.0.0.4:6667
docker automatically adds to filter table (which is dead because we never call the DOCKER chain there):
-A DOCKER -d 10.0.0.42/32 ! -i br-0a5ad9e85c71 -o br-0a5ad9e85c71 -p tcp -m tcp --dport 6666 -j ACCEPT
-A DOCKER -d 10.0.0.4/32 ! -i br-0a5ad9e85c71 -o br-0a5ad9e85c71 -p tcp -m tcp --dport 6667 -j ACCEPT

from external where 192.168.56.101 is the external ip of the docker host:
nc -v 192.168.56.101 6666 #works flawlessly, as expected
nc -v 192.168.56.101 6667 #does not work, as expected, gets dropped by FORWARD default policy

Yep, connectivity works as expected.


